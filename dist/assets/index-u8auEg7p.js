import{j as e,B as d,c as y,k as Y,r as h,l as J,y as P}from"./index-d9TgJTTy.js";import{D as T,f as X,b as k,c as ee,d as K,g as se,u as q,a as B,e as p,L as S}from"./use-auth-store-CiawQdvf.js";import{u as te,S as ae,T as ne,U as ie}from"./user-nav-1-09pvFT.js";import{u as re,g as le,a as ce,b as oe,c as de,d as me,e as ue,T as xe,f as ge,h as D,i as he,j as F,k as pe,l as R}from"./table-DaUOpY8m.js";import{D as fe,C as je,d as Ce,e as Ne,M as ve,Q as we,k as ye,S as Se,l as De,m as be,j as Ie,A as I,P as Te,n as ke,F as Me,f as Pe,g as z,h as Fe,E as Re}from"./index-CD610jSn.js";import{S as ze,a as Ve,b as Ee,c as Ae,d as Ue}from"./select-cMMktxW9.js";import{I as He}from"./input-DpwfBUf3.js";import{B as w}from"./badge-DjWKEn-0.js";import{P as $e,a as Oe,b as Le,C as Ye,c as Ke,d as qe,e as Be,f as V,g as E,h as Ze}from"./popover-CnlP89lX.js";import{S as Ge}from"./separator-BUjyEJiy.js";import{I as Qe}from"./IconPlus-DdfCuiNF.js";import{C as A}from"./checkbox-BGteumho.js";import{t as We}from"./use-toast-CWbngCX6.js";import{D as _e,a as Je,b as Xe,c as es,d as ss}from"./dialog-BlA-gPk4.js";import{u as ts}from"./useMutation-scFYzLXQ.js";import{c as N}from"./campaign.service-cFIIIhqk.js";import{c as as}from"./createLucideIcon-BDxxsDtu.js";import{t as U,m as Z,a as G,c as ns,i as H,f as $}from"./format-OUeO2N_p.js";import"./index-Chc_HW3c.js";import"./index-EIcx_2LO.js";import"./Combination-D2mTRfsA.js";import"./index-LU4gLCaG.js";import"./index-DT5heVsp.js";import"./index-BIPiAFp5.js";import"./instance-BGpPafi2.js";import"./index-W6PM2pC6.js";import"./index-BCvMni3w.js";import"./extends-CF3RwP-h.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=as("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);function rs({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-auto px-2",children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(ze,{value:`${s.getState().pagination.pageSize}`,onValueChange:t=>{s.setPageSize(Number(t))},children:[e.jsx(Ve,{className:"h-8 w-[70px]",children:e.jsx(Ee,{placeholder:s.getState().pagination.pageSize})}),e.jsx(Ae,{side:"top",children:[10,20,30,40,50].map(t=>e.jsx(Ue,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(d,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(fe,{className:"h-4 w-4"})]}),e.jsxs(d,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(je,{className:"h-4 w-4"})]}),e.jsxs(d,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(Ce,{className:"h-4 w-4"})]}),e.jsxs(d,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(Ne,{className:"h-4 w-4"})]})]})]})]})}function ls({table:s}){return e.jsxs(T,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(k,{align:"end",className:"w-[150px]",children:[e.jsx(ee,{children:"Toggle columns"}),e.jsx(K,{}),s.getAllColumns().filter(t=>typeof t.accessorFn<"u"&&t.getCanHide()).map(t=>e.jsx(se,{className:"capitalize",checked:t.getIsVisible(),onCheckedChange:a=>t.toggleVisibility(!!a),children:t.id},t.id))]})]})}const cs=[{value:"backlog",label:"Backlog",icon:we},{value:"todo",label:"Todo",icon:ye},{value:"in progress",label:"In Progress",icon:Se},{value:"done",label:"Done",icon:De},{value:"canceled",label:"Canceled",icon:be}],os=[{label:"Pending",value:"Pending",icon:Ie},{label:"Paid",value:"Paid",icon:I}];function O({column:s,title:t,options:a}){const n=s==null?void 0:s.getFacetedUniqueValues(),i=new Set(s==null?void 0:s.getFilterValue());return e.jsxs($e,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),t,(i==null?void 0:i.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(w,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:i.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:i.size>2?e.jsxs(w,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[i.size," selected"]}):a.filter(r=>i.has(r.value)).map(r=>e.jsx(w,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},r.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Ye,{children:[e.jsx(Ke,{placeholder:t}),e.jsxs(qe,{children:[e.jsx(Be,{children:"No results found."}),e.jsx(V,{children:a.map(r=>{const l=i.has(r.value);return e.jsxs(E,{onSelect:()=>{l?i.delete(r.value):i.add(r.value);const c=Array.from(i);s==null||s.setFilterValue(c.length?c:void 0)},children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",l?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ke,{className:y("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label}),(n==null?void 0:n.get(r.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(r.value)})]},r.value)})}),i.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ze,{}),e.jsx(V,{children:e.jsx(E,{onSelect:()=>s==null?void 0:s.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function ds({table:s}){var i;const t=s.getState().columnFilters.length>0,a=Y(),{user:n}=q();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(He,{placeholder:"Filter ...",value:((i=s.getColumn("title"))==null?void 0:i.getFilterValue())??"",onChange:r=>{var l;return(l=s.getColumn("title"))==null?void 0:l.setFilterValue(r.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("status")&&e.jsx(O,{column:s.getColumn("status"),title:"Status",options:cs}),s.getColumn("priority")&&e.jsx(O,{column:s.getColumn("priority"),title:"Status",options:os}),(n==null?void 0:n.customer)&&e.jsxs(d,{variant:"default",onClick:()=>a("/automations/add-campagin"),className:"h-8 px-2 lg:px-3",children:["Create new",e.jsx(Qe,{className:"ml-2 h-4 w-4"})]}),e.jsxs(d,{variant:"default",className:"h-8 px-2 lg:px-3",children:["Export",e.jsx(Me,{className:"ml-2 h-4 w-4"})]})]}),t&&e.jsxs(d,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Pe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(ls,{table:s})]})}function ms({columns:s,data:t,pagination:a,onPaginationChange:n,totalElements:i}){var M;const[r,l]=h.useState({}),[c,u]=h.useState({}),[o,g]=h.useState([]),[W,_]=h.useState([]),j=re({data:t,columns:s,state:{sorting:W,columnVisibility:c,rowSelection:r,columnFilters:o,pagination:a},manualPagination:!0,pageCount:Math.ceil(i/a.pageSize),onPaginationChange:x=>{const m=typeof x=="function"?x(a):x;n(m)},enableRowSelection:!0,onRowSelectionChange:l,onSortingChange:_,onColumnFiltersChange:g,onColumnVisibilityChange:u,getCoreRowModel:le(),getFilteredRowModel:ce(),getPaginationRowModel:oe(),getSortedRowModel:de(),getFacetedRowModel:me(),getFacetedUniqueValues:ue()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ds,{table:j}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(xe,{children:[e.jsx(ge,{children:j.getHeaderGroups().map(x=>e.jsx(D,{children:x.headers.map(m=>e.jsx(he,{colSpan:m.colSpan,children:m.isPlaceholder?null:F(m.column.columnDef.header,m.getContext())},m.id))},x.id))}),e.jsx(pe,{children:(M=j.getRowModel().rows)!=null&&M.length?j.getRowModel().rows.map(x=>e.jsx(D,{"data-state":x.getIsSelected()&&"selected",children:x.getVisibleCells().map(m=>e.jsx(R,{children:F(m.column.columnDef.cell,m.getContext())},m.id))},x.id)):e.jsx(D,{children:e.jsx(R,{colSpan:s==null?void 0:s.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(rs,{table:j})]})}function f({column:s,title:t,className:a}){return s.getCanSort()?e.jsx("div",{className:y("flex items-center space-x-2",a),children:e.jsxs(T,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(d,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),s.getIsSorted()==="desc"?e.jsx(I,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(z,{className:"ml-2 h-4 w-4"}):e.jsx(Fe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(k,{align:"start",children:[e.jsxs(p,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(z,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(p,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(I,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),e.jsx(K,{}),e.jsxs(p,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(Re,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})}):e.jsx("div",{className:y(a),children:t})}const us=({mode:s,onClose:t,campaignId:a,campaign:n})=>{const i=J();console.log(s,a,n);const r=ts({mutationFn:async()=>{s==="disable"?await N.campaignAction(`disable/${a}`):s==="enable"?await N.campaignAction(`enable/${a}`):s==="delete"&&await N.deleteCampaign(a)},onSuccess:()=>{P.success(`Campaign ${s}d successfully`),i.invalidateQueries({queryKey:["campaigns"]}),t()},onError:c=>{var o,g;const u=((g=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:g.message)||`Failed to ${s} campaign`;P.error(u)}}),l=()=>{r.mutate()};return e.jsx(_e,{open:!0,onOpenChange:t,children:e.jsxs(Je,{children:[e.jsxs(Xe,{children:[e.jsxs(es,{children:[s," campaign"]}),e.jsxs(ss,{children:["Are you sure you want to ",s," this ",e.jsx("strong",{children:n}),"?"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(d,{variant:"secondary",onClick:t,children:"Cancel"}),e.jsx(d,{variant:"destructive",loading:r.isPending,onClick:l,disabled:r.isPending,children:"Confirm"})]})]})})};function xs({row:s}){const t=Y(),a=s.original,[n,i]=h.useState("enable"),[r,l]=h.useState(!1),c=()=>{if(!(a!=null&&a.id)){We({title:"Error",description:"Campaign ID is missing.",variant:"destructive"});return}t(`/automations/campaign/${a.id}`,{state:{campaign:a}})};return e.jsxs(T,{children:[e.jsx(B,{asChild:!0,children:e.jsx(d,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(is,{className:"h-4 w-4"})})}),e.jsxs(k,{align:"end",children:[e.jsx(p,{onClick:c,children:"View"}),a.active?e.jsx(p,{onClick:()=>{l(!0),i("disable")},children:"Disabe"}):e.jsx(p,{onClick:()=>{l(!0),i("enable")},children:"Enable"}),e.jsx(p,{onClick:()=>{l(!0),i("delete")},children:"Delete"})]}),r&&e.jsx(us,{campaign:a.name,campaignId:a.id,mode:n,onClose:()=>l(!1)})]})}function L(s,t){const a=()=>ns(t==null?void 0:t.in,NaN),i=fs(s);let r;if(i.date){const o=js(i.date,2);r=Cs(o.restDateString,o.year)}if(!r||isNaN(+r))return a();const l=+r;let c=0,u;if(i.time&&(c=Ns(i.time),isNaN(c)))return a();if(i.timezone){if(u=vs(i.timezone),isNaN(u))return a()}else{const o=new Date(l+c),g=U(0,t==null?void 0:t.in);return g.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),g.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),g}return U(l+c+u,t==null?void 0:t.in)}const v={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},gs=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,hs=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ps=/^([+-])(\d{2})(?::?(\d{2}))?$/;function fs(s){const t={},a=s.split(v.dateTimeDelimiter);let n;if(a.length>2)return t;if(/:/.test(a[0])?n=a[0]:(t.date=a[0],n=a[1],v.timeZoneDelimiter.test(t.date)&&(t.date=s.split(v.timeZoneDelimiter)[0],n=s.substr(t.date.length,s.length))),n){const i=v.timezone.exec(n);i?(t.time=n.replace(i[1],""),t.timezone=i[1]):t.time=n}return t}function js(s,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=s.match(a);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:r===null?i:r*100,restDateString:s.slice((n[1]||n[2]).length)}}function Cs(s,t){if(t===null)return new Date(NaN);const a=s.match(gs);if(!a)return new Date(NaN);const n=!!a[4],i=C(a[1]),r=C(a[2])-1,l=C(a[3]),c=C(a[4]),u=C(a[5])-1;if(n)return bs(t,c,u)?ws(t,c,u):new Date(NaN);{const o=new Date(0);return!Ss(t,r,l)||!Ds(t,i)?new Date(NaN):(o.setUTCFullYear(t,r,Math.max(i,l)),o)}}function C(s){return s?parseInt(s):1}function Ns(s){const t=s.match(hs);if(!t)return NaN;const a=b(t[1]),n=b(t[2]),i=b(t[3]);return Is(a,n,i)?a*Z+n*G+i*1e3:NaN}function b(s){return s&&parseFloat(s.replace(",","."))||0}function vs(s){if(s==="Z")return 0;const t=s.match(ps);if(!t)return 0;const a=t[1]==="+"?-1:1,n=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Ts(n,i)?a*(n*Z+i*G):NaN}function ws(s,t,a){const n=new Date(0);n.setUTCFullYear(s,0,4);const i=n.getUTCDay()||7,r=(t-1)*7+a+1-i;return n.setUTCDate(n.getUTCDate()+r),n}const ys=[31,null,31,30,31,30,31,31,30,31,30,31];function Q(s){return s%400===0||s%4===0&&s%100!==0}function Ss(s,t,a){return t>=0&&t<=11&&a>=1&&a<=(ys[t]||(Q(s)?29:28))}function Ds(s,t){return t>=1&&t<=(Q(s)?366:365)}function bs(s,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function Is(s,t,a){return s===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&s>=0&&s<25}function Ts(s,t){return t>=0&&t<=59}const ks=[{id:"select",header:({table:s})=>e.jsx(A,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(A,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsx(f,{column:s,title:"#"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(f,{column:s,title:"Title"}),cell:({row:s})=>e.jsx("div",{className:"max-w-[150px] truncate",children:s.getValue("name")})},{accessorKey:"description",header:({column:s})=>e.jsx(f,{column:s,title:"Description"}),cell:({row:s})=>e.jsxs("div",{className:"max-w-[200px] truncate",children:[String(s.getValue("description")).substring(0,50),"..."]})},{accessorKey:"startDate",header:({column:s})=>e.jsx(f,{column:s,title:"Start Date"}),cell:({row:s})=>{var n;const t=(n=s==null?void 0:s.original)==null?void 0:n.startDate;if(!t)return"N/A";const a=L(t);return H(a)?$(a,"yyyy-MM-dd"):"Invalid Date"}},{accessorKey:"endDate",header:({column:s})=>e.jsx(f,{column:s,title:"End Date"}),cell:({row:s})=>{var n;const t=(n=s==null?void 0:s.original)==null?void 0:n.endDate;if(!t)return"N/A";const a=L(t);return H(a)?$(a,"yyyy-MM-dd"):"Invalid Date"}},{accessorKey:"active",header:({column:s})=>e.jsx(f,{column:s,title:"Status"}),cell:({row:s})=>e.jsx(w,{variant:s.getValue("active")===!0?"success":"destructive",children:s.getValue("active")===!0?"Active":"Not Active"})},{id:"actions",cell:({row:s})=>e.jsx(xs,{row:s})}];function nt(){const{user:s}=q(),[t,a]=h.useState({pageIndex:0,pageSize:10}),{data:n,isLoading:i}=te({queryKey:["campaigns",t.pageIndex,t.pageSize],queryFn:async()=>{if(s!=null&&s.customer){const r=await N.getCustomerCampaigns({page:t.pageIndex,size:t.pageSize});return r||{content:r.content||[],totalElements:r==null?void 0:r.totalElements}}else{const r=await N.getCampaigns({page:t.pageIndex,size:t.pageSize});return r||{content:r.content||[],totalElements:r==null?void 0:r.totalElements}}},retry:2,staleTime:5*60*1e3});return console.log(n),e.jsxs(S,{children:[e.jsxs(S.Header,{sticky:!0,className:"mt-4 lg:mt-0 md:mt-0 sm:mt-4",children:[e.jsx(ae,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ne,{}),e.jsx(ie,{})]})]}),e.jsxs(S.Body,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Campaigs"}),e.jsx("p",{className:"text-muted-foreground"})]})}),i?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white"})}):e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(ms,{data:n==null?void 0:n.content,columns:ks,pagination:t,onPaginationChange:a,totalElements:(n==null?void 0:n.totalElements)||0})})]})]})}export{nt as default};
