var t,s,e,i,a,r,n,o,h=t=>{throw TypeError(t)},l=(t,s,e)=>s.has(t)||h("Cannot "+e),u=(t,s,e)=>(l(t,s,"read from private field"),e?e.call(t):s.get(t)),c=(t,s,e)=>s.has(t)?h("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,e),d=(t,s,e,i)=>(l(t,s,"write to private field"),i?i.call(t,e):s.set(t,e),e),p=(t,s,e)=>(l(t,s,"access private method"),e);import{q as v,t as m,v as b,w as f,x as w,m as y,r as O}from"./index-DgsANLC3.js";import{n as C,s as M}from"./instance-SAW19xTi.js";var g=(o=class extends v{constructor(n,o){super(),c(this,a),c(this,t),c(this,s),c(this,e),c(this,i),d(this,t,n),this.setOptions(o),this.bindMethods(),p(this,a,r).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var i;const a=this.options;this.options=u(this,t).defaultMutationOptions(s),m(this.options,a)||u(this,t).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,e),observer:this}),(null==a?void 0:a.mutationKey)&&this.options.mutationKey&&b(a.mutationKey)!==b(this.options.mutationKey)?this.reset():"pending"===(null==(i=u(this,e))?void 0:i.state.status)&&u(this,e).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||null==(t=u(this,e))||t.removeObserver(this)}onMutationUpdate(t){p(this,a,r).call(this),p(this,a,n).call(this,t)}getCurrentResult(){return u(this,s)}reset(){var t;null==(t=u(this,e))||t.removeObserver(this),d(this,e,void 0),p(this,a,r).call(this),p(this,a,n).call(this)}mutate(s,a){var r;return d(this,i,a),null==(r=u(this,e))||r.removeObserver(this),d(this,e,u(this,t).getMutationCache().build(u(this,t),this.options)),u(this,e).addObserver(this),u(this,e).execute(s)}},t=new WeakMap,s=new WeakMap,e=new WeakMap,i=new WeakMap,a=new WeakSet,r=function(){var t;const i=(null==(t=u(this,e))?void 0:t.state)??f();d(this,s,{...i,isPending:"pending"===i.status,isSuccess:"success"===i.status,isError:"error"===i.status,isIdle:"idle"===i.status,mutate:this.mutate,reset:this.reset})},n=function(t){w.batch((()=>{var e,a,r,n,o,h,l,c;if(u(this,i)&&this.hasListeners()){const d=u(this,s).variables,p=u(this,s).context;"success"===(null==t?void 0:t.type)?(null==(a=(e=u(this,i)).onSuccess)||a.call(e,t.data,d,p),null==(n=(r=u(this,i)).onSettled)||n.call(r,t.data,null,d,p)):"error"===(null==t?void 0:t.type)&&(null==(h=(o=u(this,i)).onError)||h.call(o,t.error,d,p),null==(c=(l=u(this,i)).onSettled)||c.call(l,void 0,t.error,d,p))}this.listeners.forEach((t=>{t(u(this,s))}))}))},o);function S(t,s){const e=y(s),[i]=O.useState((()=>new g(e,t)));O.useEffect((()=>{i.setOptions(t)}),[i,t]);const a=O.useSyncExternalStore(O.useCallback((t=>i.subscribe(w.batchCalls(t))),[i]),(()=>i.getCurrentResult()),(()=>i.getCurrentResult())),r=O.useCallback(((t,s)=>{i.mutate(t,s).catch(C)}),[i]);if(a.error&&M(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:r,mutateAsync:a.mutate}}export{S as u};
