import{m as e,y as s,l as a,r as n,j as r,B as l}from"./index-DgsANLC3.js";import{u as t}from"./index.esm-3KLEzfMo.js";import{z as i}from"./index-B0zZW6rS.js";import{t as o}from"./zod-8yhIYjTx.js";import{F as d,a as u,b as c,c as m,d as p,e as x,f as h}from"./form-CU8rwvsz.js";import{I as v}from"./input-BaSBk-Gd.js";import{u as j,L as y}from"./use-auth-store-DlB6JPqf.js";import{u as g,S as f,T as b,U as I}from"./user-nav-BjY9odv6.js";import{S as D}from"./react-select.esm-DN-60AWJ.js";import{T as C}from"./textarea-B6_lc-Cl.js";import{S as N}from"./switch-zc68LWSA.js";import{C as T}from"./card-Cxkzk52A.js";import{c as k}from"./contacts.service-CB5R8qdu.js";import{s as S}from"./senderid.services-ChtNoxr4.js";import{t as M}from"./template.service-B_nG4bwh.js";import{u as P}from"./useMutation-Bxa_RUaj.js";import{c as R}from"./campaign.service-DA5zuygM.js";import{t as L}from"./use-toast-CWYfqMVY.js";import"./label-BTdkY-TR.js";import"./index-D_xSc7Or.js";import"./index-8bOQzAwE.js";import"./index-ccUYw2Nl.js";import"./Combination-BCJfLLTG.js";import"./index-ByCmscx5.js";import"./index-BuCM2Ckj.js";import"./index-BQ1RgSiI.js";import"./instance-SAW19xTi.js";import"./extends-DPdBf6DS.js";import"./index-D9Jk-2g6.js";import"./index-DCG-2Pmh.js";function E(e,s){const a=q();return(E=function(e,s){return a[e-=474]})(e,s)}!function(){const e=E,s=q();for(;;)try{if(328634===-parseInt(e(476))/1+parseInt(e(512))/2*(-parseInt(e(484))/3)+parseInt(e(503))/4+-parseInt(e(497))/5*(-parseInt(e(509))/6)+parseInt(e(489))/7+parseInt(e(482))/8*(parseInt(e(485))/9)+-parseInt(e(496))/10*(parseInt(e(494))/11))break;s.push(s.shift())}catch(a){s.push(s.shift())}}();const Y=function(){let e=!0;return function(s,a){const n=e?function(){if(a){const e=a[E(490)](s,arguments);return a=null,e}}:function(){};return e=!1,n}}()(void 0,(function(){const e=E,s={FcKGu:e(508)};return Y[e(499)]()[e(492)](e(508))[e(499)]()[e(478)](Y)[e(492)](s[e(501)])}));function q(){const e=["12652MkKuKP","response","Failed to create campaign","155101iYzORn","campaigns","constructor","dmisA","RAccR","success","98824yHpMnX","uNPRN","267UHpyHi","351JmVSzW","createCampaign","invalidateQueries","Failed to delete campaign","1896090evrvFl","apply","BBVdT","search","error","253BTtRpq","Campaign updated successfully","272620owxfgs","2885890ReOzkM","deleteCampaign","toString","vOBBr","FcKGu","message","1375840avzhZm","Campaign deleted successfully","TKszV","NTSEh","updateCampaign","(((.+)+)+)+$","6DzNrKS","data","Failed to update campaign"];return(q=function(){return e})()}Y();const w=[{value:"DAILY",label:"Daily"},{value:"WEEKLY",label:"Weekly"},{value:"MONTHLY",label:"Monthly"},{value:"YEARLY",label:"Yearly"}],z=[{value:"MON",label:"Monday"},{value:"TUE",label:"Tuesday"},{value:"WED",label:"Wednesday"},{value:"THU",label:"Thursday"},{value:"FRI",label:"Friday"},{value:"SAT",label:"Saturday"},{value:"SUN",label:"Sunday"}],A=Array.from({length:31},((e,s)=>({value:s+1,label:`${s+1}`}))),B=[{value:"01",label:"January"},{value:"02",label:"February"},{value:"03",label:"March"},{value:"04",label:"April"},{value:"05",label:"May"},{value:"06",label:"June"},{value:"07",label:"July"},{value:"08",label:"August"},{value:"09",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],F=i.object({name:i.string().min(1,"Name is required"),description:i.any(),phoneBooks:i.array(i.number()).min(1,"Phone Books are required"),senderId:i.number().min(1,"Sender ID is required"),messageTemplate:i.number().min(1,"Message Template is required"),startDate:i.any().optional(),endDate:i.any().optional(),recurring:i.boolean().default(!1),recurringPeriod:i.string().optional(),nextRunDate:i.any().optional(),isActive:i.boolean().default(!0),weeklyDays:i.array(i.string()).optional(),monthlyDates:i.array(i.number()).optional(),yearlyMonth:i.string().optional(),yearlyDate:i.number().optional(),runTime:i.any().optional()}).superRefine(((e,s)=>{var a,n;if(e.recurring)switch(e.startDate||s.addIssue({code:i.ZodIssueCode.custom,message:"Start date is required for recurring campaigns",path:["startDate"]}),e.endDate||s.addIssue({code:i.ZodIssueCode.custom,message:"End date is required for recurring campaigns",path:["endDate"]}),e.recurringPeriod||s.addIssue({code:i.ZodIssueCode.custom,message:"Recurring period is required",path:["recurringPeriod"]}),e.recurringPeriod){case"WEEKLY":(null==(a=e.weeklyDays)?void 0:a.length)||s.addIssue({code:i.ZodIssueCode.custom,message:"Weekly days are required",path:["weeklyDays"]});break;case"MONTHLY":(null==(n=e.monthlyDates)?void 0:n.length)||s.addIssue({code:i.ZodIssueCode.custom,message:"Monthly dates are required",path:["monthlyDates"]});break;case"YEARLY":e.yearlyMonth||s.addIssue({code:i.ZodIssueCode.custom,message:"Yearly month is required",path:["yearlyMonth"]}),e.yearlyDate||s.addIssue({code:i.ZodIssueCode.custom,message:"Yearly date is required",path:["yearlyDate"]});break;case"DAILY":e.runTime||s.addIssue({code:i.ZodIssueCode.custom,message:"Run time is required for daily campaigns",path:["runTime"]})}else e.nextRunDate||s.addIssue({code:i.ZodIssueCode.custom,message:"Next run date is required",path:["nextRunDate"]})})),K=()=>{const{user:i}=j(),{createCampaign:Y}=(()=>{const a=E,n={TKszV:a(477),dmisA:"Campaign created successfully",zbImL:a(475),sAvpZ:a(495),RAccR:a(511),vOBBr:a(504),BBVdT:a(488),uNPRN:function(e){return e()},NTSEh:function(e,s){return e(s)}},r=n[a(483)](e);return{createCampaign:P({mutationFn:({data:e})=>R[a(486)](e),onSuccess:()=>{const e=a;r[e(487)]({queryKey:[n[e(505)]]}),s[e(481)](n[e(479)])},onError:e=>{var r,l;const t=a,i=(null==(l=null==(r=null==e?void 0:e.response)?void 0:r[t(510)])?void 0:l[t(502)])||n.zbImL;s.error(i)}}),updateCampaign:P({mutationFn:({id:e,data:s})=>R[a(507)](e,s),onSuccess:()=>{const e=a;r[e(487)]({queryKey:["campaigns"]}),s[e(481)](n.sAvpZ)},onError:e=>{var r,l;const t=a,i=(null==(l=null==(r=null==e?void 0:e[t(474)])?void 0:r[t(510)])?void 0:l.message)||n[t(480)];s[t(493)](i)}}),deleteCampaign:n[a(506)](P,{mutationFn:e=>R[a(498)](e),onSuccess:()=>{const e=a;r[e(487)]({queryKey:[n[e(505)]]}),s[e(481)](n[e(500)])},onError:e=>{var r,l;const t=a,i=(null==(l=null==(r=null==e?void 0:e[t(474)])?void 0:r[t(510)])?void 0:l[t(502)])||n[t(491)];s[t(493)](i)}})}})(),q=a(),[K,Z]=n.useState(""),O=t({resolver:o(F),defaultValues:{name:"",description:null,phoneBooks:[],senderId:void 0,messageTemplate:void 0,startDate:null,endDate:null,recurring:!1,recurringPeriod:void 0,nextRunDate:null,isActive:!0,weeklyDays:[],monthlyDates:[],yearlyMonth:void 0,yearlyDate:1,runTime:null}}),W=O.watch("recurring"),H=O.watch("recurringPeriod"),V=O.watch("messageTemplate"),{data:U,isLoading:$}=g({queryKey:["phone-books"],queryFn:async()=>{var e;const s=await k.getCustomerPhoneBooks({page:0,size:10});return(null==(e=null==s?void 0:s.content)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]}}),{data:J,isLoading:G}=g({queryKey:["sender-ids"],queryFn:async()=>{var e;const s=await S.getCustomerSenderIds({page:0,size:100});return(null==(e=null==s?void 0:s.content)?void 0:e.map((e=>({value:e.id,label:e.senderId}))))||[]}}),{data:Q,isLoading:X}=g({queryKey:["templates"],queryFn:async()=>{var e;const s=await M.getCustomerTemplates(null==(e=null==i?void 0:i.customer)?void 0:e.id,{page:0,size:100});return(null==s?void 0:s.map((e=>({value:e.id,label:e.name,content:e.message}))))||[]}});n.useEffect((()=>{if(V&&Q){const e=Q.find((e=>e.value===V));Z((null==e?void 0:e.content)||"")}else Z("")}),[V,Q]);return r.jsxs(y,{children:[r.jsxs(y.Header,{sticky:!0,children:[r.jsx(f,{}),r.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[r.jsx(b,{}),r.jsx(I,{})]})]}),r.jsx(y.Body,{children:r.jsxs(T,{className:"mx-auto w-fit p-8",children:[r.jsx("h1",{className:"mb-12 text-3xl font-semibold",children:"Create Campaign"}),r.jsx(d,{...O,children:r.jsxs("form",{onSubmit:O.handleSubmit((e=>{var s;let a=[];switch(e.recurringPeriod){case"DAILY":a=[e.runTime||""];break;case"WEEKLY":a=e.weeklyDays||[];break;case"MONTHLY":a=(null==(s=e.monthlyDates)?void 0:s.map(String))||[];break;case"YEARLY":a=[`${e.yearlyMonth}-${e.yearlyDate}`];break;default:e.recurring||(a=[e.nextRunDate||""])}const n={...e,periodParam:a.length>0?a:void 0};Y.mutate({data:n},{onSuccess:()=>{L({title:"Success",description:"Campaign created successfully!"}),q("/automations")},onError:e=>{L({title:"Error",description:"Failed to create campaign. Please try again.",variant:"destructive"})}})})),className:"space-y-0",children:[r.jsxs("div",{className:"grid grid-cols-1 gap-20 md:grid-cols-2",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),r.jsx(u,{control:O.control,name:"name",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Campaign Name *"}),r.jsx(p,{children:r.jsx(v,{...e})}),r.jsx(x,{})]})}),r.jsx(u,{control:O.control,name:"description",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Description"}),r.jsx(p,{children:r.jsx(C,{...e})}),r.jsx(x,{})]})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Content Selection"}),r.jsx(u,{control:O.control,name:"messageTemplate",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Message Template *"}),r.jsx(D,{isLoading:X,options:Q,onChange:s=>{e.onChange(null==s?void 0:s.value),Z((null==s?void 0:s.content)||"")},value:null==Q?void 0:Q.find((s=>s.value===e.value)),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})}),V&&r.jsx(c,{children:r.jsx(T,{className:"p-4 bg-muted/50",children:r.jsx("div",{className:"whitespace-pre-wrap text-sm",children:K})})}),r.jsx(u,{control:O.control,name:"senderId",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Sender ID *"}),r.jsx(D,{isLoading:G,options:J,onChange:s=>e.onChange(null==s?void 0:s.value),value:null==J?void 0:J.find((s=>s.value===e.value)),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Audience"}),r.jsx(u,{control:O.control,name:"phoneBooks",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Phone Books *"}),r.jsx(D,{isMulti:!0,isLoading:$,options:U,onChange:s=>e.onChange(null==s?void 0:s.map((e=>e.value))),value:null==U?void 0:U.filter((s=>{var a;return null==(a=e.value)?void 0:a.includes(s.value)})),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Schedule"}),r.jsx(u,{control:O.control,name:"recurring",render:({field:e})=>r.jsx(c,{className:"rounded-lg border p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"space-y-0.5",children:[r.jsx(m,{children:"Recurring Campaign"}),r.jsx(h,{children:"Enable to schedule multiple runs"})]}),r.jsx(p,{children:r.jsx(N,{checked:e.value,onCheckedChange:e.onChange})})]})})}),W?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(u,{control:O.control,name:"startDate",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Start Date *"}),r.jsx(v,{type:"date",...e}),r.jsx(x,{})]})}),r.jsx(u,{control:O.control,name:"endDate",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"End Date *"}),r.jsx(v,{type:"date",...e}),r.jsx(x,{})]})})]}),r.jsx(u,{control:O.control,name:"recurringPeriod",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Recurring Period *"}),r.jsx(D,{options:w,onChange:s=>e.onChange(null==s?void 0:s.value),value:w.find((s=>s.value===e.value)),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})}),"WEEKLY"===H&&r.jsx(u,{control:O.control,name:"weeklyDays",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Days of Week *"}),r.jsx(D,{isMulti:!0,options:z,value:z.filter((s=>{var a;return null==(a=e.value)?void 0:a.includes(s.value)})),onChange:s=>e.onChange(null==s?void 0:s.map((e=>e.value))),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})}),"MONTHLY"===H&&r.jsx(u,{control:O.control,name:"monthlyDates",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Monthly Dates *"}),r.jsx(D,{isMulti:!0,options:A,value:A.filter((s=>{var a;return null==(a=e.value)?void 0:a.includes(s.value)})),onChange:s=>e.onChange(null==s?void 0:s.map((e=>e.value))),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})}),"YEARLY"===H&&r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(u,{control:O.control,name:"yearlyMonth",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Month *"}),r.jsx(D,{options:B,value:B.find((s=>s.value===e.value)),onChange:s=>e.onChange(null==s?void 0:s.value),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})}),r.jsx(u,{control:O.control,name:"yearlyDate",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Day *"}),r.jsx(D,{options:A,value:A.find((s=>s.value===e.value)),onChange:s=>e.onChange(null==s?void 0:s.value),styles:{menuPortal:e=>({...e,zIndex:999})}}),r.jsx(x,{})]})})]}),"DAILY"===H&&r.jsx(u,{control:O.control,name:"runTime",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Daily Run Time *"}),r.jsx(v,{type:"time",...e}),r.jsx(x,{})]})})]}):r.jsx(u,{control:O.control,name:"nextRunDate",render:({field:e})=>r.jsxs(c,{children:[r.jsx(m,{children:"Next Run Date *"}),r.jsx(v,{type:"datetime-local",...e}),r.jsx(x,{})]})})]})]})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(l,{type:"submit",className:"w-full md:w-auto",loading:Y.isPending,children:"Create Campaign"})})]})})]})})]})};export{K as CampaignForm,K as default};
