import{l as O,y as v,k as Z,r as F,j as e,B as H}from"./index-d9TgJTTy.js";import{u as U}from"./index.esm-B6ab4Cq_.js";import{z as r}from"./index-C3hmKdn7.js";import{t as Q}from"./zod-CLsu2KRF.js";import{F as z,a as d,b as o,c as u,d as N,e as m,f as $}from"./form-DxQsSBla.js";import{I as f}from"./input-DpwfBUf3.js";import{u as J,L as I}from"./use-auth-store-CiawQdvf.js";import{u as M,S as _,T as G,U as V}from"./user-nav-1-09pvFT.js";import{S as x}from"./react-select.esm-BLyL2-KV.js";import{T as X}from"./textarea-DzV--754.js";import{S as ee}from"./switch-DRK12Lcm.js";import{C as L}from"./card-CWiURnhm.js";import{c as ae}from"./contacts.service-WxEaevo_.js";import{s as se}from"./senderid.services-oF-ok74q.js";import{t as re}from"./template.service-BIwPJcYg.js";import{u as T}from"./useMutation-scFYzLXQ.js";import{c as k}from"./campaign.service-cFIIIhqk.js";import{t as R}from"./use-toast-CWbngCX6.js";import"./label-BkzUlrRU.js";import"./index-Chc_HW3c.js";import"./index-CD610jSn.js";import"./index-EIcx_2LO.js";import"./Combination-D2mTRfsA.js";import"./index-LU4gLCaG.js";import"./index-DT5heVsp.js";import"./index-BIPiAFp5.js";import"./instance-BGpPafi2.js";import"./extends-CF3RwP-h.js";import"./index-DTsOzCj_.js";import"./index-W6PM2pC6.js";const ne=()=>{const i=O(),c=T({mutationFn:({data:t})=>k.createCampaign(t),onSuccess:()=>{i.invalidateQueries({queryKey:["campaigns"]}),v.success("Campaign created successfully")},onError:t=>{var g,h;const n=((h=(g=t==null?void 0:t.response)==null?void 0:g.data)==null?void 0:h.message)||"Failed to create campaign";v.error(n)}}),p=T({mutationFn:({id:t,data:n})=>k.updateCampaign(t,n),onSuccess:()=>{i.invalidateQueries({queryKey:["campaigns"]}),v.success("Campaign updated successfully")},onError:t=>{var g,h;const n=((h=(g=t==null?void 0:t.response)==null?void 0:g.data)==null?void 0:h.message)||"Failed to update campaign";v.error(n)}}),j=T({mutationFn:t=>k.deleteCampaign(t),onSuccess:()=>{i.invalidateQueries({queryKey:["campaigns"]}),v.success("Campaign deleted successfully")},onError:t=>{var g,h;const n=((h=(g=t==null?void 0:t.response)==null?void 0:g.data)==null?void 0:h.message)||"Failed to delete campaign";v.error(n)}});return{createCampaign:c,updateCampaign:p,deleteCampaign:j}},w=[{value:"DAILY",label:"Daily"},{value:"WEEKLY",label:"Weekly"},{value:"MONTHLY",label:"Monthly"},{value:"YEARLY",label:"Yearly"}],q=[{value:"MON",label:"Monday"},{value:"TUE",label:"Tuesday"},{value:"WED",label:"Wednesday"},{value:"THU",label:"Thursday"},{value:"FRI",label:"Friday"},{value:"SAT",label:"Saturday"},{value:"SUN",label:"Sunday"}],S=Array.from({length:31},(i,c)=>({value:c+1,label:`${c+1}`})),Y=[{value:"01",label:"January"},{value:"02",label:"February"},{value:"03",label:"March"},{value:"04",label:"April"},{value:"05",label:"May"},{value:"06",label:"June"},{value:"07",label:"July"},{value:"08",label:"August"},{value:"09",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],le=r.object({name:r.string().min(1,"Name is required"),description:r.any(),phoneBooks:r.array(r.number()).min(1,"Phone Books are required"),senderId:r.number().min(1,"Sender ID is required"),messageTemplate:r.number().min(1,"Message Template is required"),startDate:r.any().optional(),endDate:r.any().optional(),recurring:r.boolean().default(!1),recurringPeriod:r.string().optional(),nextRunDate:r.any().optional(),isActive:r.boolean().default(!0),weeklyDays:r.array(r.string()).optional(),monthlyDates:r.array(r.number()).optional(),yearlyMonth:r.string().optional(),yearlyDate:r.number().optional(),runTime:r.any().optional()}).superRefine((i,c)=>{var p,j;if(i.recurring)switch(i.startDate||c.addIssue({code:r.ZodIssueCode.custom,message:"Start date is required for recurring campaigns",path:["startDate"]}),i.endDate||c.addIssue({code:r.ZodIssueCode.custom,message:"End date is required for recurring campaigns",path:["endDate"]}),i.recurringPeriod||c.addIssue({code:r.ZodIssueCode.custom,message:"Recurring period is required",path:["recurringPeriod"]}),i.recurringPeriod){case"WEEKLY":(p=i.weeklyDays)!=null&&p.length||c.addIssue({code:r.ZodIssueCode.custom,message:"Weekly days are required",path:["weeklyDays"]});break;case"MONTHLY":(j=i.monthlyDates)!=null&&j.length||c.addIssue({code:r.ZodIssueCode.custom,message:"Monthly dates are required",path:["monthlyDates"]});break;case"YEARLY":i.yearlyMonth||c.addIssue({code:r.ZodIssueCode.custom,message:"Yearly month is required",path:["yearlyMonth"]}),i.yearlyDate||c.addIssue({code:r.ZodIssueCode.custom,message:"Yearly date is required",path:["yearlyDate"]});break;case"DAILY":i.runTime||c.addIssue({code:r.ZodIssueCode.custom,message:"Run time is required for daily campaigns",path:["runTime"]});break}else i.nextRunDate||c.addIssue({code:r.ZodIssueCode.custom,message:"Next run date is required",path:["nextRunDate"]})}),Ye=()=>{const{user:i}=J(),{createCampaign:c}=ne(),p=Z(),[j,t]=F.useState(""),n=U({resolver:Q(le),defaultValues:{name:"",description:null,phoneBooks:[],senderId:void 0,messageTemplate:void 0,startDate:null,endDate:null,recurring:!1,recurringPeriod:void 0,nextRunDate:null,isActive:!0,weeklyDays:[],monthlyDates:[],yearlyMonth:void 0,yearlyDate:1,runTime:null}}),g=n.watch("recurring"),h=n.watch("recurringPeriod"),b=n.watch("messageTemplate"),{data:C,isLoading:P}=M({queryKey:["phone-books"],queryFn:async()=>{var a;const s=await ae.getCustomerPhoneBooks({page:0,size:10});return((a=s==null?void 0:s.content)==null?void 0:a.map(l=>({value:l.id,label:l.name})))||[]}}),{data:D,isLoading:A}=M({queryKey:["sender-ids"],queryFn:async()=>{var a;const s=await se.getCustomerSenderIds({page:0,size:100});return((a=s==null?void 0:s.content)==null?void 0:a.map(l=>({value:l.id,label:l.senderId})))||[]}}),{data:y,isLoading:K}=M({queryKey:["templates"],queryFn:async()=>{var a;const s=await re.getCustomerTemplates((a=i==null?void 0:i.customer)==null?void 0:a.id,{page:0,size:100});return(s==null?void 0:s.map(l=>({value:l.id,label:l.name,content:l.message})))||[]}});F.useEffect(()=>{if(b&&y){const s=y.find(a=>a.value===b);t((s==null?void 0:s.content)||"")}else t("")},[b,y]);const W=s=>{var E;let a=[];switch(s.recurringPeriod){case"DAILY":a=[s.runTime||""];break;case"WEEKLY":a=s.weeklyDays||[];break;case"MONTHLY":a=((E=s.monthlyDates)==null?void 0:E.map(String))||[];break;case"YEARLY":a=[`${s.yearlyMonth}-${s.yearlyDate}`];break;default:s.recurring||(a=[s.nextRunDate||""])}const l={...s,periodParam:a.length>0?a:void 0};c.mutate({data:l},{onSuccess:()=>{R({title:"Success",description:"Campaign created successfully!"}),p("/automations")},onError:B=>{R({title:"Error",description:"Failed to create campaign. Please try again.",variant:"destructive"}),console.error("Error creating campaign:",B)}})};return e.jsxs(I,{children:[e.jsxs(I.Header,{sticky:!0,children:[e.jsx(_,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(G,{}),e.jsx(V,{})]})]}),e.jsx(I.Body,{children:e.jsxs(L,{className:"mx-auto p-8",children:[e.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Create Campaign"}),e.jsx(z,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(W),className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsx(d,{control:n.control,name:"name",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Campaign Name *"}),e.jsx(N,{children:e.jsx(f,{...s})}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Description"}),e.jsx(N,{children:e.jsx(X,{...s})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Content Selection"}),e.jsx(d,{control:n.control,name:"messageTemplate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Message Template *"}),e.jsx(x,{isLoading:K,options:y,onChange:a=>{console.log(a),s.onChange(a==null?void 0:a.value),t((a==null?void 0:a.content)||"")},value:y==null?void 0:y.find(a=>a.value===s.value)}),e.jsx(m,{})]})}),b&&e.jsx(o,{children:e.jsx(L,{className:"p-4 bg-muted/50",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:j})})}),e.jsx(d,{control:n.control,name:"senderId",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Sender ID *"}),e.jsx(x,{isLoading:A,options:D,onChange:a=>s.onChange(a==null?void 0:a.value),value:D==null?void 0:D.find(a=>a.value===s.value)}),e.jsx(m,{})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Audience"}),e.jsx(d,{control:n.control,name:"phoneBooks",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Phone Books *"}),e.jsx(x,{isMulti:!0,isLoading:P,options:C,onChange:a=>s.onChange(a==null?void 0:a.map(l=>l.value)),value:C==null?void 0:C.filter(a=>{var l;return(l=s.value)==null?void 0:l.includes(a.value)})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Schedule"}),e.jsx(d,{control:n.control,name:"recurring",render:({field:s})=>e.jsx(o,{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(u,{children:"Recurring Campaign"}),e.jsx($,{children:"Enable to schedule multiple runs"})]}),e.jsx(N,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange})})]})})}),g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:n.control,name:"startDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Start Date *"}),e.jsx(f,{type:"date",...s}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"endDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"End Date *"}),e.jsx(f,{type:"date",...s}),e.jsx(m,{})]})})]}),e.jsx(d,{control:n.control,name:"recurringPeriod",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Recurring Period *"}),e.jsx(x,{options:w,onChange:a=>s.onChange(a==null?void 0:a.value),value:w.find(a=>a.value===s.value)}),e.jsx(m,{})]})}),h==="WEEKLY"&&e.jsx(d,{control:n.control,name:"weeklyDays",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Days of Week *"}),e.jsx(x,{isMulti:!0,options:q,value:q.filter(a=>{var l;return(l=s.value)==null?void 0:l.includes(a.value)}),onChange:a=>s.onChange(a==null?void 0:a.map(l=>l.value))}),e.jsx(m,{})]})}),h==="MONTHLY"&&e.jsx(d,{control:n.control,name:"monthlyDates",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Monthly Dates *"}),e.jsx(x,{isMulti:!0,options:S,value:S.filter(a=>{var l;return(l=s.value)==null?void 0:l.includes(a.value)}),onChange:a=>s.onChange(a==null?void 0:a.map(l=>l.value))}),e.jsx(m,{})]})}),h==="YEARLY"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:n.control,name:"yearlyMonth",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Month *"}),e.jsx(x,{options:Y,value:Y.find(a=>a.value===s.value),onChange:a=>s.onChange(a==null?void 0:a.value)}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"yearlyDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Day *"}),e.jsx(x,{options:S,value:S.find(a=>a.value===s.value),onChange:a=>s.onChange(a==null?void 0:a.value)}),e.jsx(m,{})]})})]}),h==="DAILY"&&e.jsx(d,{control:n.control,name:"runTime",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Daily Run Time *"}),e.jsx(f,{type:"time",...s}),e.jsx(m,{})]})})]}):e.jsx(d,{control:n.control,name:"nextRunDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(u,{children:"Next Run Date *"}),e.jsx(f,{type:"datetime-local",...s}),e.jsx(m,{})]})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(H,{type:"submit",className:"w-full md:w-auto",loading:c.isPending,children:"Create Campaign"})})]})})]})})]})};export{Ye as CampaignForm,Ye as default};
