import{j as e,B as s,c as a,l as t,r as n,m as l,y as i}from"./index-DgsANLC3.js";import{D as r,f as o,b as c,c as d,d as m,g as u,u as x,a as g,e as h,L as j}from"./use-auth-store-DlB6JPqf.js";import{u as p,S as f,T as v,U as N}from"./user-nav-BjY9odv6.js";import{u as w,T as C,a as b,b as y,c as S,f as D,d as k,e as P,g as I,h as F,i as z,j as T,k as M,l as V}from"./table-DgNG9M6V.js";import{D as R,C as E,d as U,e as A,M as $,Q as H,k as K,S as G,l as Z,m as q,j as B,A as Y,P as L,n as Q,F as J,f as O,g as W,h as _,E as X}from"./index-8bOQzAwE.js";import{S as ee,a as se,b as ae,c as te,d as ne}from"./select-B9KeDb6u.js";import{I as le}from"./input-BaSBk-Gd.js";import{B as ie}from"./badge-DkFHinrL.js";import{P as re,a as oe,b as ce,C as de,c as me,d as ue,e as xe,f as ge,g as he,h as je}from"./popover-BfTfSh0J.js";import{S as pe}from"./separator-E74WL0Px.js";import{I as fe}from"./IconPlus-CVwxeCme.js";import{C as ve}from"./checkbox-CDTCacFG.js";import{t as Ne}from"./use-toast-CWYfqMVY.js";import{D as we,a as Ce,b as be,c as ye,d as Se}from"./dialog-Cxh4_yU0.js";import{u as De}from"./useMutation-Bxa_RUaj.js";import{c as ke}from"./campaign.service-DA5zuygM.js";import{c as Pe}from"./createLucideIcon-DHucisN1.js";import{c as Ie,t as Fe,m as ze,a as Te,f as Me,i as Ve}from"./format-2Kviky6Q.js";import"./index-D_xSc7Or.js";import"./index-ccUYw2Nl.js";import"./Combination-BCJfLLTG.js";import"./index-ByCmscx5.js";import"./index-BuCM2Ckj.js";import"./index-BQ1RgSiI.js";import"./instance-SAW19xTi.js";import"./index-DCG-2Pmh.js";import"./index-BEsgrMAU.js";import"./extends-DPdBf6DS.js";
/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Pe("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);function Ee({table:a}){return e.jsxs("div",{className:"flex items-center justify-between overflow-auto px-2",children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[a.getFilteredSelectedRowModel().rows.length," of"," ",a.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(ee,{value:`${a.getState().pagination.pageSize}`,onValueChange:e=>{a.setPageSize(Number(e))},children:[e.jsx(se,{className:"h-8 w-[70px]",children:e.jsx(ae,{placeholder:a.getState().pagination.pageSize})}),e.jsx(te,{side:"top",children:[10,20,30,40,50].map((s=>e.jsx(ne,{value:`${s}`,children:s},s)))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",a.getState().pagination.pageIndex+1," of"," ",a.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(s,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(0),disabled:!a.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(R,{className:"h-4 w-4"})]}),e.jsxs(s,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(E,{className:"h-4 w-4"})]}),e.jsxs(s,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(U,{className:"h-4 w-4"})]}),e.jsxs(s,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(a.getPageCount()-1),disabled:!a.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(A,{className:"h-4 w-4"})]})]})]})]})}function Ue({table:a}){return e.jsxs(r,{children:[e.jsx(o,{asChild:!0,children:e.jsxs(s,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(c,{align:"end",className:"w-[150px]",children:[e.jsx(d,{children:"Toggle columns"}),e.jsx(m,{}),a.getAllColumns().filter((e=>void 0!==e.accessorFn&&e.getCanHide())).map((s=>e.jsx(u,{className:"capitalize",checked:s.getIsVisible(),onCheckedChange:e=>s.toggleVisibility(!!e),children:s.id},s.id)))]})]})}const Ae=[{value:"backlog",label:"Backlog",icon:H},{value:"todo",label:"Todo",icon:K},{value:"in progress",label:"In Progress",icon:G},{value:"done",label:"Done",icon:Z},{value:"canceled",label:"Canceled",icon:q}],$e=[{label:"Pending",value:"Pending",icon:B},{label:"Paid",value:"Paid",icon:Y}];function He({column:t,title:n,options:l}){const i=null==t?void 0:t.getFacetedUniqueValues(),r=new Set(null==t?void 0:t.getFilterValue());return e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(s,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),n,(null==r?void 0:r.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(ie,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(ie,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):l.filter((e=>r.has(e.value))).map((s=>e.jsx(ie,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:s.label},s.value)))})]})]})}),e.jsx(ce,{className:"w-[200px] p-0",align:"start",children:e.jsxs(de,{children:[e.jsx(me,{placeholder:n}),e.jsxs(ue,{children:[e.jsx(xe,{children:"No results found."}),e.jsx(ge,{children:l.map((s=>{const n=r.has(s.value);return e.jsxs(he,{onSelect:()=>{n?r.delete(s.value):r.add(s.value);const e=Array.from(r);null==t||t.setFilterValue(e.length?e:void 0)},children:[e.jsx("div",{className:a("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",n?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Q,{className:a("h-4 w-4")})}),s.icon&&e.jsx(s.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.label}),(null==i?void 0:i.get(s.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:i.get(s.value)})]},s.value)}))}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsx(ge,{children:e.jsx(he,{onSelect:()=>null==t?void 0:t.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function Ke({table:a}){var n;const l=a.getState().columnFilters.length>0,i=t(),{user:r}=x();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(le,{placeholder:"Filter ...",value:(null==(n=a.getColumn("title"))?void 0:n.getFilterValue())??"",onChange:e=>{var s;return null==(s=a.getColumn("title"))?void 0:s.setFilterValue(e.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[a.getColumn("status")&&e.jsx(He,{column:a.getColumn("status"),title:"Status",options:Ae}),a.getColumn("priority")&&e.jsx(He,{column:a.getColumn("priority"),title:"Status",options:$e}),(null==r?void 0:r.customer)&&e.jsxs(s,{variant:"default",onClick:()=>i("/automations/add-campagin"),className:"h-8 px-2 lg:px-3",children:["Create new",e.jsx(fe,{className:"ml-2 h-4 w-4"})]}),e.jsxs(s,{variant:"default",className:"h-8 px-2 lg:px-3",children:["Export",e.jsx(J,{className:"ml-2 h-4 w-4"})]})]}),l&&e.jsxs(s,{variant:"ghost",onClick:()=>a.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(O,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Ue,{table:a})]})}function Ge({columns:s,data:a,pagination:t,onPaginationChange:l,totalElements:i}){var r;const[o,c]=n.useState({}),[d,m]=n.useState({}),[u,x]=n.useState([]),[g,h]=n.useState([]),j=w({data:a,columns:s,state:{sorting:g,columnVisibility:d,rowSelection:o,columnFilters:u,pagination:t},manualPagination:!0,pageCount:Math.ceil(i/t.pageSize),onPaginationChange:e=>{const s="function"==typeof e?e(t):e;l(s)},enableRowSelection:!0,onRowSelectionChange:c,onSortingChange:h,onColumnFiltersChange:x,onColumnVisibilityChange:m,getCoreRowModel:V(),getFilteredRowModel:M(),getPaginationRowModel:T(),getSortedRowModel:z(),getFacetedRowModel:F(),getFacetedUniqueValues:I()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ke,{table:j}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(C,{children:[e.jsx(b,{children:j.getHeaderGroups().map((s=>e.jsx(y,{children:s.headers.map((s=>e.jsx(S,{colSpan:s.colSpan,children:s.isPlaceholder?null:D(s.column.columnDef.header,s.getContext())},s.id)))},s.id)))}),e.jsx(k,{children:(null==(r=j.getRowModel().rows)?void 0:r.length)?j.getRowModel().rows.map((s=>e.jsx(y,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map((s=>e.jsx(P,{children:D(s.column.columnDef.cell,s.getContext())},s.id)))},s.id))):e.jsx(y,{children:e.jsx(P,{colSpan:null==s?void 0:s.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(Ee,{table:j})]})}function Ze({column:t,title:n,className:l}){return t.getCanSort()?e.jsx("div",{className:a("flex items-center space-x-2",l),children:e.jsxs(r,{children:[e.jsx(g,{asChild:!0,children:e.jsxs(s,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:n}),"desc"===t.getIsSorted()?e.jsx(Y,{className:"ml-2 h-4 w-4"}):"asc"===t.getIsSorted()?e.jsx(W,{className:"ml-2 h-4 w-4"}):e.jsx(_,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(c,{align:"start",children:[e.jsxs(h,{onClick:()=>t.toggleSorting(!1),children:[e.jsx(W,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(h,{onClick:()=>t.toggleSorting(!0),children:[e.jsx(Y,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),e.jsx(m,{}),e.jsxs(h,{onClick:()=>t.toggleVisibility(!1),children:[e.jsx(X,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})}):e.jsx("div",{className:a(l),children:n})}const qe=({mode:a,onClose:t,campaignId:n,campaign:r})=>{const o=l(),c=De({mutationFn:async()=>{"disable"===a?await ke.campaignAction(`disable/${n}`):"enable"===a?await ke.campaignAction(`enable/${n}`):"delete"===a&&await ke.deleteCampaign(n)},onSuccess:()=>{i.success(`Campaign ${a}d successfully`),o.invalidateQueries({queryKey:["campaigns"]}),t()},onError:e=>{var s,t;const n=(null==(t=null==(s=null==e?void 0:e.response)?void 0:s.data)?void 0:t.message)||`Failed to ${a} campaign`;i.error(n)}});return e.jsx(we,{open:!0,onOpenChange:t,children:e.jsxs(Ce,{children:[e.jsxs(be,{children:[e.jsxs(ye,{children:[a," campaign"]}),e.jsxs(Se,{children:["Are you sure you want to ",a," this ",e.jsx("strong",{children:r}),"?"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(s,{variant:"secondary",onClick:t,children:"Cancel"}),e.jsx(s,{variant:"destructive",loading:c.isPending,onClick:()=>{c.mutate()},disabled:c.isPending,children:"Confirm"})]})]})})};function Be({row:a}){const l=t(),i=a.original,[o,d]=n.useState("enable"),[m,u]=n.useState(!1);return e.jsxs(r,{children:[e.jsx(g,{asChild:!0,children:e.jsx(s,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Re,{className:"h-4 w-4"})})}),e.jsxs(c,{align:"end",children:[e.jsx(h,{onClick:()=>{(null==i?void 0:i.id)?l(`/automations/campaign/${i.id}`,{state:{campaign:i}}):Ne({title:"Error",description:"Campaign ID is missing.",variant:"destructive"})},children:"View"}),i.active?e.jsx(h,{onClick:()=>{u(!0),d("disable")},children:"Disabe"}):e.jsx(h,{onClick:()=>{u(!0),d("enable")},children:"Enable"}),e.jsx(h,{onClick:()=>{u(!0),d("delete")},children:"Delete"})]}),m&&e.jsx(qe,{campaign:i.name,campaignId:i.id,mode:o,onClose:()=>u(!1)})]})}function Ye(e,s){const a=()=>Ie(null==s?void 0:s.in,NaN),t=function(e){const s={},a=e.split(Le.dateTimeDelimiter);let t;if(a.length>2)return s;/:/.test(a[0])?t=a[0]:(s.date=a[0],t=a[1],Le.timeZoneDelimiter.test(s.date)&&(s.date=e.split(Le.timeZoneDelimiter)[0],t=e.substr(s.date.length,e.length)));if(t){const e=Le.timezone.exec(t);e?(s.time=t.replace(e[1],""),s.timezone=e[1]):s.time=t}return s}(e);let n;if(t.date){const e=function(e,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),t=e.match(a);if(!t)return{year:NaN,restDateString:""};const n=t[1]?parseInt(t[1]):null,l=t[2]?parseInt(t[2]):null;return{year:null===l?n:100*l,restDateString:e.slice((t[1]||t[2]).length)}}(t.date,2);n=function(e,s){if(null===s)return new Date(NaN);const a=e.match(Qe);if(!a)return new Date(NaN);const t=!!a[4],n=We(a[1]),l=We(a[2])-1,i=We(a[3]),r=We(a[4]),o=We(a[5])-1;if(t)return function(e,s,a){return s>=1&&s<=53&&a>=0&&a<=6}(0,r,o)?function(e,s,a){const t=new Date(0);t.setUTCFullYear(e,0,4);const n=t.getUTCDay()||7,l=7*(s-1)+a+1-n;return t.setUTCDate(t.getUTCDate()+l),t}(s,r,o):new Date(NaN);{const e=new Date(0);return function(e,s,a){return s>=0&&s<=11&&a>=1&&a<=(Xe[s]||(es(e)?29:28))}(s,l,i)&&function(e,s){return s>=1&&s<=(es(e)?366:365)}(s,n)?(e.setUTCFullYear(s,l,Math.max(n,i)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!n||isNaN(+n))return a();const l=+n;let i,r=0;if(t.time&&(r=function(e){const s=e.match(Je);if(!s)return NaN;const a=_e(s[1]),t=_e(s[2]),n=_e(s[3]);if(!function(e,s,a){if(24===e)return 0===s&&0===a;return a>=0&&a<60&&s>=0&&s<60&&e>=0&&e<25}(a,t,n))return NaN;return a*ze+t*Te+1e3*n}(t.time),isNaN(r)))return a();if(!t.timezone){const e=new Date(l+r),a=Fe(0,null==s?void 0:s.in);return a.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),a.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),a}return i=function(e){if("Z"===e)return 0;const s=e.match(Oe);if(!s)return 0;const a="+"===s[1]?-1:1,t=parseInt(s[2]),n=s[3]&&parseInt(s[3])||0;if(!function(e,s){return s>=0&&s<=59}(0,n))return NaN;return a*(t*ze+n*Te)}(t.timezone),isNaN(i)?a():Fe(l+r+i,null==s?void 0:s.in)}const Le={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Qe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Je=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Oe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function We(e){return e?parseInt(e):1}function _e(e){return e&&parseFloat(e.replace(",","."))||0}const Xe=[31,null,31,30,31,30,31,31,30,31,30,31];function es(e){return e%400==0||e%4==0&&e%100!=0}const ss=[{id:"select",header:({table:s})=>e.jsx(ve,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(ve,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsx(Ze,{column:s,title:"#"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(Ze,{column:s,title:"Title"}),cell:({row:s})=>e.jsx("div",{className:"max-w-[150px] truncate",children:s.getValue("name")})},{accessorKey:"description",header:({column:s})=>e.jsx(Ze,{column:s,title:"Description"}),cell:({row:s})=>e.jsxs("div",{className:"max-w-[200px] truncate",children:[String(s.getValue("description")).substring(0,50),"..."]})},{accessorKey:"startDate",header:({column:s})=>e.jsx(Ze,{column:s,title:"Start Date"}),cell:({row:e})=>{var s;const a=null==(s=null==e?void 0:e.original)?void 0:s.startDate;if(!a)return"N/A";const t=Ye(a);return Ve(t)?Me(t,"yyyy-MM-dd"):"Invalid Date"}},{accessorKey:"endDate",header:({column:s})=>e.jsx(Ze,{column:s,title:"End Date"}),cell:({row:e})=>{var s;const a=null==(s=null==e?void 0:e.original)?void 0:s.endDate;if(!a)return"N/A";const t=Ye(a);return Ve(t)?Me(t,"yyyy-MM-dd"):"Invalid Date"}},{accessorKey:"active",header:({column:s})=>e.jsx(Ze,{column:s,title:"Status"}),cell:({row:s})=>e.jsx(ie,{variant:!0===s.getValue("active")?"success":"destructive",children:!0===s.getValue("active")?"Active":"Not Active"})},{id:"actions",cell:({row:s})=>e.jsx(Be,{row:s})}];function as(){const{user:s}=x(),[a,t]=n.useState({pageIndex:0,pageSize:10}),{data:l,isLoading:i}=p({queryKey:["campaigns",a.pageIndex,a.pageSize],queryFn:async()=>{if(null==s?void 0:s.customer){const e=await ke.getCustomerCampaigns({page:a.pageIndex,size:a.pageSize});return e||{content:e.content||[],totalElements:null==e?void 0:e.totalElements}}{const e=await ke.getCampaigns({page:a.pageIndex,size:a.pageSize});return e||{content:e.content||[],totalElements:null==e?void 0:e.totalElements}}},retry:2,staleTime:3e5});return e.jsxs(j,{children:[e.jsxs(j.Header,{sticky:!0,className:"mt-4 lg:mt-0 md:mt-0 sm:mt-4",children:[e.jsx(f,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(v,{}),e.jsx(N,{})]})]}),e.jsxs(j.Body,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Campaigs"}),e.jsx("p",{className:"text-muted-foreground"})]})}),i?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white"})}):e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ge,{data:null==l?void 0:l.content,columns:ss,pagination:a,onPaginationChange:t,totalElements:(null==l?void 0:l.totalElements)||0})})]})]})}export{as as default};
