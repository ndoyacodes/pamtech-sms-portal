import{l as O,k as B,y as T,r as P,j as e,B as A}from"./index-d9TgJTTy.js";import{u as L}from"./index.esm-B6ab4Cq_.js";import{z as l}from"./index-C3hmKdn7.js";import{t as q}from"./zod-CLsu2KRF.js";import{F as R,a as t,b as i,c as o,d as c,e as m,f as v}from"./form-DxQsSBla.js";import{I as M}from"./input-DpwfBUf3.js";import{u as K,L as y}from"./use-auth-store-CiawQdvf.js";import{u as b,S as z,T as U,U as H}from"./user-nav-1-09pvFT.js";import{T as C}from"./textarea-DzV--754.js";import{S as Q}from"./switch-DRK12Lcm.js";import{C as _}from"./card-CWiURnhm.js";import{c as V}from"./contacts.service-WxEaevo_.js";import{s as $}from"./senderid.services-oF-ok74q.js";import{m as G}from"./message.service-D7RZzy-l.js";import{u as J}from"./useMutation-scFYzLXQ.js";import{t as W}from"./template.service-BIwPJcYg.js";import{S as N}from"./react-select.esm-BLyL2-KV.js";import"./label-BkzUlrRU.js";import"./index-Chc_HW3c.js";import"./index-CD610jSn.js";import"./index-EIcx_2LO.js";import"./Combination-D2mTRfsA.js";import"./index-LU4gLCaG.js";import"./index-DT5heVsp.js";import"./index-BIPiAFp5.js";import"./instance-BGpPafi2.js";import"./index-W6PM2pC6.js";import"./extends-CF3RwP-h.js";import"./index-DTsOzCj_.js";const X=()=>{const j=O(),x=B();return{sendBulkSMS:J({mutationFn:({data:d})=>G.sendBulkSMS(d),onSuccess:()=>{j.invalidateQueries({queryKey:["sms"]}),T.success("Campaign was successfully sent."),x("/")},onError:d=>{var p,h;const S=((h=(p=d==null?void 0:d.response)==null?void 0:p.data)==null?void 0:h.message)||"Failed to send sms";T.error(S)}})}},Y=[{value:"PHONEBOOK",label:"Phone Book"},{value:"FILE",label:"Excel File"},{value:"COMMA_SEPARATED",label:"Comma Separated Numbers"}],Z=l.object({senderId:l.number().min(1,{message:"Sender ID is required"}),phonebookId:l.any().optional(),message:l.string().min(1,{message:"Message is required"}),messageType:l.string().min(1,{message:"Message type is required"}),scheduled:l.boolean().default(!1),scheduleDateTime:l.string().optional(),saveAsTemplate:l.boolean().default(!1),recipients:l.string().optional(),recipientMode:l.string().min(1,{message:"Recipient mode is required"}),file:l.any().optional(),commaSeparatedNumbers:l.string().optional(),messageTemplate:l.number().optional(),useTemplate:l.boolean().default(!1)}),ke=()=>{const{sendBulkSMS:j}=X(),{user:x}=K(),n=L({resolver:q(Z),defaultValues:{senderId:void 0,phonebookId:void 0,message:"",messageType:"static",scheduled:!1,scheduleDateTime:"",saveAsTemplate:!1,recipients:"",recipientMode:"PHONEBOOK",file:null,commaSeparatedNumbers:"",messageTemplate:void 0,useTemplate:!1}}),d=n.watch("recipientMode"),S=n.watch("scheduled"),p=n.watch("useTemplate"),h=n.watch("messageTemplate"),{data:g,isLoading:I}=b({queryKey:["phone-books"],queryFn:async()=>{var a;const s=await V.getCustomerPhoneBooks({page:0,size:100});return((a=s==null?void 0:s.content)==null?void 0:a.map(r=>({value:r.id,label:r.name})))||[]}}),{data:f,isLoading:E}=b({queryKey:["sender-ids"],queryFn:async()=>{var a;const s=await $.getCustomerSenderIds({page:0,size:100});return((a=s==null?void 0:s.content)==null?void 0:a.map(r=>({value:r.id,label:r.senderId})))||[]}}),{data:u,isLoading:k}=b({queryKey:["templates"],queryFn:async()=>{var a;const s=await W.getCustomerTemplates((a=x==null?void 0:x.customer)==null?void 0:a.id,{page:0,size:100});return(s==null?void 0:s.map(r=>({value:r.id,label:r.name,message:r.message})))||[]}}),F=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];a&&n.setValue("file",a)};P.useEffect(()=>{if(p&&h&&u){const s=u.find(a=>a.value===h);s&&n.setValue("message",s.message)}},[h,u,n,p]);const w=s=>{const a=new FormData;switch(a.append("senderId",s.senderId),a.append("message",s.message),a.append("messageType",s.messageType),a.append("scheduled",s.scheduled.toString()),a.append("saveAsTemplate",s.saveAsTemplate.toString()),a.append("recipientMode",s.recipientMode),s.scheduled&&s.scheduleDateTime&&a.append("scheduleDateTime",s.scheduleDateTime),s.recipientMode){case"PHONEBOOK":a.append("phonebookId",s.phonebookId),a.append("recipients",s.phonebookId);break;case"FILE":s.file&&(a.append("file",s.file),a.append("recipients",s.file));break;case"COMMA_SEPARATED":a.append("recipients",s.commaSeparatedNumbers);break}j.mutate({data:a})},D=()=>{switch(d){case"PHONEBOOK":return e.jsx(t,{control:n.control,name:"phonebookId",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Phone Book *"}),e.jsx(c,{children:e.jsx(N,{isLoading:I,isMulti:!0,placeholder:"Select phone book",options:g,onChange:a=>s.onChange(a==null?void 0:a.map(r=>r.value)),value:g==null?void 0:g.filter(a=>{var r;return(r=s.value)==null?void 0:r.includes(a.value)})})}),e.jsx(m,{})]})});case"FILE":return e.jsx(t,{control:n.control,name:"file",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Upload Excel File *"}),e.jsx(c,{children:e.jsx(M,{type:"file",accept:".xlsx,.xls",onChange:F})}),e.jsx(v,{children:"Upload an Excel file containing phone numbers in the first column."}),e.jsx(m,{})]})});case"COMMA_SEPARATED":return e.jsx(t,{control:n.control,name:"commaSeparatedNumbers",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Phone Numbers *"}),e.jsx(c,{children:e.jsx(C,{placeholder:"Enter phone numbers separated by commas (e.g., +1234567890, +9876543210)",className:"h-32 resize-none",...s})}),e.jsx(v,{children:"Enter phone numbers in international format, separated by commas."}),e.jsx(m,{})]})});default:return null}};return e.jsxs(y,{children:[e.jsxs(y.Header,{sticky:!0,className:"mt-4 lg:mt-0 md:mt-0 sm:mt-4",children:[e.jsx(z,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(U,{}),e.jsx(H,{})]})]}),e.jsx(y.Body,{children:e.jsxs(_,{className:"mx-auto w-1/2 p-8",children:[e.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Quick Send"}),e.jsx(R,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(w),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Sender Information"}),e.jsx(t,{control:n.control,name:"senderId",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Sender ID *"}),e.jsx(c,{children:e.jsx(N,{isLoading:E,placeholder:"Select sender ID",options:f,onChange:a=>s.onChange(a==null?void 0:a.value),value:f==null?void 0:f.find(a=>a.value===s.value)})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Recipients"}),e.jsx(t,{control:n.control,name:"recipientMode",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Recipient Mode *"}),e.jsx(c,{children:e.jsx("div",{className:"flex flex-col space-y-2",children:Y.map(a=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:a.value,checked:s.value===a.value,onChange:()=>s.onChange(a.value),className:"form-radio"}),e.jsx("span",{children:a.label})]},a.value))})}),e.jsx(m,{})]})}),D()]}),e.jsx("div",{className:"space-y-4",children:S&&e.jsx(t,{control:n.control,name:"scheduleDateTime",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Schedule Date and Time *"}),e.jsx(c,{children:e.jsx(M,{type:"datetime-local",...s})}),e.jsx(m,{})]})})})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Message Content"}),e.jsx(t,{control:n.control,name:"useTemplate",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{className:"text-base",children:"Use Predefined Template"}),e.jsx(v,{children:"Select a predefined template for your message."})]}),e.jsx(c,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})})]})}),p&&e.jsx(t,{control:n.control,name:"messageTemplate",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Message Template *"}),e.jsx(N,{isLoading:k,options:u,onChange:a=>s.onChange(a==null?void 0:a.value),value:u==null?void 0:u.find(a=>a.value===s.value)}),e.jsx(m,{})]})}),e.jsx(t,{control:n.control,name:"message",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Message *"}),e.jsx(c,{children:e.jsx(C,{placeholder:"Enter your message",className:"h-32 resize-none",...s,disabled:p})}),e.jsx(m,{})]})})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(A,{type:"submit",className:"w-full md:w-auto",loading:j.isPending,children:"Send Message"})})]})})]})})]})};export{ke as BulkSMSForm,ke as default};
