import{m as e,l as s,y as n,r as a,j as r,B as i}from"./index-DgsANLC3.js";import{u as l}from"./index.esm-3KLEzfMo.js";import{z as t}from"./index-B0zZW6rS.js";import{t as o}from"./zod-8yhIYjTx.js";import{F as d,a as c,b as m,c as u,d as p,e as x,f as h}from"./form-CU8rwvsz.js";import{I as j}from"./input-BaSBk-Gd.js";import{u as f,L as g}from"./use-auth-store-DlB6JPqf.js";import{u as v,S as b,T as y,U as S}from"./user-nav-BjY9odv6.js";import{T as I}from"./textarea-B6_lc-Cl.js";import{S as N}from"./switch-zc68LWSA.js";import{C as T}from"./card-Cxkzk52A.js";import{c as C}from"./contacts.service-CB5R8qdu.js";import{s as M}from"./senderid.services-ChtNoxr4.js";import{m as k}from"./message.service-zEf1GUs7.js";import{u as E}from"./useMutation-Bxa_RUaj.js";import{t as w}from"./template.service-B_nG4bwh.js";import{S as O}from"./react-select.esm-DN-60AWJ.js";import"./label-BTdkY-TR.js";import"./index-D_xSc7Or.js";import"./index-8bOQzAwE.js";import"./index-ccUYw2Nl.js";import"./Combination-BCJfLLTG.js";import"./index-ByCmscx5.js";import"./index-BuCM2Ckj.js";import"./index-BQ1RgSiI.js";import"./instance-SAW19xTi.js";import"./index-DCG-2Pmh.js";import"./extends-DPdBf6DS.js";import"./index-D9Jk-2g6.js";function P(){const e=["AfPWt","1322238IwRpkT","search","sms","sendBulkSMS","8SuQWqw","success","1028923SIAcJH","data","response","Campaign was successfully sent.","ILCWI","520684ZTnaxu","xuiOC","Failed to send sms","message","4139109BzcsWi","invalidateQueries","86460QHrxnx","ozCFR","2JdLSXk","toString","111655oeAqPR","3743576emISgP","(((.+)+)+)+$"];return(P=function(){return e})()}!function(){const e=F,s=P();for(;;)try{if(277953===parseInt(e(391))/1+parseInt(e(374))/2*(-parseInt(e(380))/3)+parseInt(e(384))/4*(parseInt(e(376))/5)+parseInt(e(372))/6+parseInt(e(386))/7+-parseInt(e(377))/8+parseInt(e(370))/9)break;s.push(s.shift())}catch(n){s.push(s.shift())}}();const A=function(){let e=!0;return function(s,n){const a=e?function(){if(n){const e=n.apply(s,arguments);return n=null,e}}:function(){};return e=!1,a}}()(void 0,(function(){const e=F,s={xuiOC:e(378)};return A[e(375)]()[e(381)](e(378))[e(375)]().constructor(A)[e(381)](s[e(392)])}));function F(e,s){const n=P();return(F=function(e,s){return n[e-=370]})(e,s)}A();const D=[{value:"PHONEBOOK",label:"Phone Book"},{value:"FILE",label:"Excel File"},{value:"COMMA_SEPARATED",label:"Comma Separated Numbers"}],L=t.object({senderId:t.number().min(1,{message:"Sender ID is required"}),phonebookId:t.any().optional(),message:t.string().min(1,{message:"Message is required"}),messageType:t.string().min(1,{message:"Message type is required"}),scheduled:t.boolean().default(!1),scheduleDateTime:t.string().optional(),saveAsTemplate:t.boolean().default(!1),recipients:t.string().optional(),recipientMode:t.string().min(1,{message:"Recipient mode is required"}),file:t.any().optional(),commaSeparatedNumbers:t.string().optional(),messageTemplate:t.number().optional(),useTemplate:t.boolean().default(!1)}),q=()=>{const{sendBulkSMS:t}=(()=>{const a=F,r={hmjiJ:a(382),ILCWI:a(389),ozCFR:function(e,s){return e(s)},czCFa:a(393),AfPWt:function(e){return e()}},i=r[a(379)](e),l=r[a(379)](s);return{sendBulkSMS:E({mutationFn:({data:e})=>k[a(383)](e),onSuccess:()=>{const e=a;i[e(371)]({queryKey:[r.hmjiJ]}),n[e(385)](r[e(390)]),r[e(373)](l,"/")},onError:e=>{var s,i;const l=a,t=(null==(i=null==(s=null==e?void 0:e[l(388)])?void 0:s[l(387)])?void 0:i[l(394)])||r.czCFa;n.error(t)}})}})(),{user:P}=f(),A=l({resolver:o(L),defaultValues:{senderId:void 0,phonebookId:void 0,message:"",messageType:"static",scheduled:!1,scheduleDateTime:"",saveAsTemplate:!1,recipients:"",recipientMode:"PHONEBOOK",file:null,commaSeparatedNumbers:"",messageTemplate:void 0,useTemplate:!1}}),q=A.watch("recipientMode"),B=A.watch("scheduled"),z=A.watch("useTemplate"),R=A.watch("messageTemplate"),{data:K,isLoading:H}=v({queryKey:["phone-books"],queryFn:async()=>{var e;const s=await C.getCustomerPhoneBooks({page:0,size:100});return(null==(e=null==s?void 0:s.content)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]}}),{data:W,isLoading:Q}=v({queryKey:["sender-ids"],queryFn:async()=>{var e;const s=await M.getCustomerSenderIds({page:0,size:100});return(null==(e=null==s?void 0:s.content)?void 0:e.map((e=>({value:e.id,label:e.senderId}))))||[]}}),{data:J,isLoading:U}=v({queryKey:["templates"],queryFn:async()=>{var e;const s=await w.getCustomerTemplates(null==(e=null==P?void 0:P.customer)?void 0:e.id,{page:0,size:100});return(null==s?void 0:s.map((e=>({value:e.id,label:e.name,message:e.message}))))||[]}}),V=e=>{var s;const n=null==(s=e.target.files)?void 0:s[0];n&&A.setValue("file",n)};a.useEffect((()=>{if(z&&R&&J){const e=J.find((e=>e.value===R));e&&A.setValue("message",e.message)}}),[R,J,A,z]);return r.jsxs(g,{children:[r.jsxs(g.Header,{sticky:!0,className:"mt-4 lg:mt-0 md:mt-0 sm:mt-4",children:[r.jsx(b,{}),r.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[r.jsx(y,{}),r.jsx(S,{})]})]}),r.jsx(g.Body,{children:r.jsxs(T,{className:"mx-auto w-1/2 p-8",children:[r.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Quick Send"}),r.jsx(d,{...A,children:r.jsxs("form",{onSubmit:A.handleSubmit((e=>{const s=new FormData;switch(s.append("senderId",e.senderId),s.append("message",e.message),s.append("messageType",e.messageType),s.append("scheduled",e.scheduled.toString()),s.append("saveAsTemplate",e.saveAsTemplate.toString()),s.append("recipientMode",e.recipientMode),e.scheduled&&e.scheduleDateTime&&s.append("scheduleDateTime",e.scheduleDateTime),e.recipientMode){case"PHONEBOOK":s.append("phonebookId",e.phonebookId),s.append("recipients",e.phonebookId);break;case"FILE":e.file&&(s.append("file",e.file),s.append("recipients",e.file));break;case"COMMA_SEPARATED":s.append("recipients",e.commaSeparatedNumbers)}t.mutate({data:s})})),className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Sender Information"}),r.jsx(c,{control:A.control,name:"senderId",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Sender ID *"}),r.jsx(p,{children:r.jsx(O,{isLoading:Q,placeholder:"Select sender ID",options:W,onChange:s=>e.onChange(null==s?void 0:s.value),value:null==W?void 0:W.find((s=>s.value===e.value))})}),r.jsx(x,{})]})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Recipients"}),r.jsx(c,{control:A.control,name:"recipientMode",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Recipient Mode *"}),r.jsx(p,{children:r.jsx("div",{className:"flex flex-col space-y-2",children:D.map((s=>r.jsxs("label",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"radio",value:s.value,checked:e.value===s.value,onChange:()=>e.onChange(s.value),className:"form-radio"}),r.jsx("span",{children:s.label})]},s.value)))})}),r.jsx(x,{})]})}),(()=>{switch(q){case"PHONEBOOK":return r.jsx(c,{control:A.control,name:"phonebookId",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Phone Book *"}),r.jsx(p,{children:r.jsx(O,{isLoading:H,isMulti:!0,placeholder:"Select phone book",options:K,onChange:s=>e.onChange(null==s?void 0:s.map((e=>e.value))),value:null==K?void 0:K.filter((s=>{var n;return null==(n=e.value)?void 0:n.includes(s.value)}))})}),r.jsx(x,{})]})});case"FILE":return r.jsx(c,{control:A.control,name:"file",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Upload Excel File *"}),r.jsx(p,{children:r.jsx(j,{type:"file",accept:".xlsx,.xls",onChange:V})}),r.jsx(h,{children:"Upload an Excel file containing phone numbers in the first column."}),r.jsx(x,{})]})});case"COMMA_SEPARATED":return r.jsx(c,{control:A.control,name:"commaSeparatedNumbers",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Phone Numbers *"}),r.jsx(p,{children:r.jsx(I,{placeholder:"Enter phone numbers separated by commas (e.g., +1234567890, +9876543210)",className:"h-32 resize-none",...e})}),r.jsx(h,{children:"Enter phone numbers in international format, separated by commas."}),r.jsx(x,{})]})});default:return null}})()]}),r.jsx("div",{className:"space-y-4",children:B&&r.jsx(c,{control:A.control,name:"scheduleDateTime",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Schedule Date and Time *"}),r.jsx(p,{children:r.jsx(j,{type:"datetime-local",...e})}),r.jsx(x,{})]})})})]}),r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:"Message Content"}),r.jsx(c,{control:A.control,name:"useTemplate",render:({field:e})=>r.jsxs(m,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[r.jsxs("div",{className:"space-y-0.5",children:[r.jsx(u,{className:"text-base",children:"Use Predefined Template"}),r.jsx(h,{children:"Select a predefined template for your message."})]}),r.jsx(p,{children:r.jsx(N,{checked:e.value,onCheckedChange:e.onChange})})]})}),z&&r.jsx(c,{control:A.control,name:"messageTemplate",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Message Template *"}),r.jsx(O,{isLoading:U,options:J,onChange:s=>e.onChange(null==s?void 0:s.value),value:null==J?void 0:J.find((s=>s.value===e.value))}),r.jsx(x,{})]})}),r.jsx(c,{control:A.control,name:"message",render:({field:e})=>r.jsxs(m,{children:[r.jsx(u,{children:"Message *"}),r.jsx(p,{children:r.jsx(I,{placeholder:"Enter your message",className:"h-32 resize-none",...e,disabled:z})}),r.jsx(x,{})]})})]})})]}),r.jsx("div",{className:"flex justify-end pt-4",children:r.jsx(i,{type:"submit",className:"w-full md:w-auto",loading:t.isPending,children:"Send Message"})})]})})]})})]})};export{q as BulkSMSForm,q as default};
