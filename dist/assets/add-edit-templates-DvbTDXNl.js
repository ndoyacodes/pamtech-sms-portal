import{l as k,k as q,y as r,r as D,f as w,j as e,B as I}from"./index-d9TgJTTy.js";import{u as H}from"./index.esm-B6ab4Cq_.js";import{t as K}from"./zod-CLsu2KRF.js";import{F as U,a as f,b as x,c as h,d as y,e as T}from"./form-DxQsSBla.js";import{I as $}from"./input-DpwfBUf3.js";import{S as L}from"./react-select.esm-BLyL2-KV.js";import{T as z}from"./textarea-DzV--754.js";import{u as G,L as j}from"./use-auth-store-CiawQdvf.js";import{S as J,T as W,U as X}from"./user-nav-1-09pvFT.js";import{z as S}from"./index-C3hmKdn7.js";import{u as b}from"./useMutation-scFYzLXQ.js";import{t as F}from"./template.service-BIwPJcYg.js";import"./label-BkzUlrRU.js";import"./index-Chc_HW3c.js";import"./extends-CF3RwP-h.js";import"./index-DTsOzCj_.js";import"./Combination-D2mTRfsA.js";import"./index-CD610jSn.js";import"./index-EIcx_2LO.js";import"./index-LU4gLCaG.js";import"./index-DT5heVsp.js";import"./index-BIPiAFp5.js";import"./instance-BGpPafi2.js";const Y=S.object({message:S.string(),messageType:S.enum(["dynamic","static"]),name:S.string()}),Z=()=>{const i=k(),c=q(),u=b({mutationFn:({data:s})=>F.createTemplate(s),onSuccess:()=>{c("/templates"),i.invalidateQueries({queryKey:["smsTemplates"]}),r.success("SMS template created successfully")},onError:s=>{var t,l;const m=((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to create SMS template";r.error(m)}}),p=b({mutationFn:({id:s,data:m})=>F.updateTemplate(s,m),onSuccess:()=>{c("/templates"),i.invalidateQueries({queryKey:["smsTemplates"]}),r.success("SMS template updated successfully")},onError:s=>{var t,l;const m=((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to update SMS template";r.error(m)}}),d=b({mutationFn:s=>F.deleteTemplate(s),onSuccess:()=>{c("/templates"),i.invalidateQueries({queryKey:["smsTemplates"]}),r.success("SMS template deleted successfully")},onError:s=>{var t,l;const m=((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to delete SMS template";r.error(m)}});return{createTemplate:u,updateTemplate:p,deleteTemplate:d}},_=[{value:"ColumnB",label:"Column B"},{value:"ColumnC",label:"Column C"},{value:"ColumnD",label:"Column D"},{value:"ColumnE",label:"Column E"},{value:"ColumnF",label:"Column F"}],Te=()=>{var A;const[i,c]=D.useState(0),[u,p]=D.useState([]),d=w(),s=(A=d==null?void 0:d.state)==null?void 0:A.record,m=160,{user:t}=G(),{createTemplate:l,updateTemplate:N}=Z(),B=q(),o=H({resolver:K(Y),defaultValues:s||{message:"",messageType:"static",name:"",dynamicColumn:""}}),P=a=>{var C;console.log("Form Submitted:",a);const n={...a,customerId:(C=t==null?void 0:t.customer)==null?void 0:C.id,id:s==null?void 0:s.id,dynamicColumn:u.map(g=>g.value).join(",")};s?N.mutate({id:s==null?void 0:s.id,data:n}):l.mutate({data:n})},R=()=>{B("/templates")},M=l.isPending||N.isPending,E=o.watch("messageType"),Q=a=>{if(a){const n=` {${a.value}}`,g=o.getValues("message")+n;o.setValue("message",g),c(g.length),p(v=>v.some(V=>V.value===a.value)?v:[...v,a])}};return e.jsxs(j,{children:[e.jsxs(j.Header,{sticky:!0,className:"mt-4 lg:mt-0 md:mt-0 sm:mt-4",children:[e.jsx(J,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(W,{}),e.jsx(X,{})]})]}),e.jsx(j.Header,{children:e.jsxs("h1",{className:"text-2xl font-bold",children:[s?"Edit":"Add"," Template"]})}),e.jsx(j.Body,{children:e.jsx(U,{...o,children:e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("form",{onSubmit:o.handleSubmit(P),className:"space-y-6",children:[e.jsx(f,{control:o.control,name:"name",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:"Name *"}),e.jsx(y,{children:e.jsx($,{placeholder:"Required",...a})}),e.jsx(T,{})]})}),e.jsx(f,{control:o.control,name:"messageType",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:"Available Tag"}),e.jsx(y,{children:e.jsx(L,{className:"my-react-select-container",classNamePrefix:"my-react-select",defaultValue:{value:"static",label:"static"},options:[{value:"static",label:"static"},{value:"dynamic",label:"dynamic"}],onChange:n=>{a.onChange(n==null?void 0:n.value),p([])}})})]})}),E==="dynamic"&&e.jsxs(x,{children:[e.jsx(h,{children:"Select Dynamic Column *"}),e.jsx(y,{children:e.jsx(L,{className:"my-react-select-container",classNamePrefix:"my-react-select",options:_,placeholder:"Select Column",value:null,onChange:Q})}),u.length===0&&e.jsx(T,{children:"Please select a dynamic column"})]}),e.jsx(f,{control:o.control,name:"message",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:"Message *"}),e.jsx(y,{children:e.jsx(z,{placeholder:"Enter message...",...a,onChange:n=>{a.onChange(n.target.value),c(n.target.value.length)},maxLength:m})}),e.jsxs("div",{className:"text-sm text-gray-500",children:[m-i," CHARACTERS REMAINING"]}),e.jsx(T,{})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(I,{type:"submit",className:"btn-primary",loading:M,disabled:M||E==="dynamic"&&u.length===0,children:"Save"}),e.jsx(I,{type:"button",variant:"outline",onClick:R,children:"Cancel"})]})]})})})})]})};export{Te as default};
