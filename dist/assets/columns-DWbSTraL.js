import{b as q,j as e,B as m,r as h,U as p,c as z,k as X,m as W}from"./index-d9TgJTTy.js";import{u as Q,g as $,a as J,b as Z,c as ee,d as se,e as te,T as ae,f as ne,h as A,i as le,j as U,k as re,l as Y}from"./table-DaUOpY8m.js";import{D as oe,C as ie,d as ce,e as de,M as me,F as xe,A as K,g as B,h as he,E as ge,i as ue}from"./index-CD610jSn.js";import{S as v,a as I,b,c as T,d}from"./select-cMMktxW9.js";import{D as H,f as pe,b as L,c as je,d as O,g as fe,a as G,e as N}from"./use-auth-store-CiawQdvf.js";import{z as a}from"./index-C3hmKdn7.js";import{u as we}from"./index.esm-B6ab4Cq_.js";import{t as De}from"./zod-CLsu2KRF.js";import{F as Se,a as j,b as f,c as w,d as D,e as ye}from"./form-DxQsSBla.js";import{I as P}from"./input-DpwfBUf3.js";import{u as Ne}from"./user-nav-1-09pvFT.js";import{s as Ce}from"./senderid.services-oF-ok74q.js";import{B as ve}from"./badge-DjWKEn-0.js";import{C as _}from"./checkbox-BGteumho.js";/**
 * @license @tabler/icons-react v3.28.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ie=q("outline","filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]);function be({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-auto px-2",children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(v,{value:`${s.getState().pagination.pageSize}`,onValueChange:l=>{s.setPageSize(Number(l))},children:[e.jsx(I,{className:"h-8 w-[70px]",children:e.jsx(b,{placeholder:s.getState().pagination.pageSize})}),e.jsx(T,{side:"top",children:[10,20,30,40,50].map(l=>e.jsx(d,{value:`${l}`,children:l},l))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(oe,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(ie,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(ce,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(de,{className:"h-4 w-4"})]})]})]})]})}function Te({table:s}){return e.jsxs(H,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(L,{align:"end",className:"w-[150px]",children:[e.jsx(je,{children:"Toggle columns"}),e.jsx(O,{}),s.getAllColumns().filter(l=>typeof l.accessorFn<"u"&&l.getCanHide()).map(l=>e.jsx(fe,{className:"capitalize",checked:l.getIsVisible(),onCheckedChange:c=>l.toggleVisibility(!!c),children:l.id},l.id))]})]})}const Fe=a.object({period:a.string().optional(),fromDate:a.string().optional(),toDate:a.string().optional(),direction:a.string().optional(),type:a.string().optional(),status:a.string().optional(),fromAddress:a.string().optional(),messageId:a.string().optional(),senderId:a.number().optional(),recipient:a.string().optional(),msisdn:a.string().optional()}),Re=(s,l)=>s==="senderId"?"NUMBER":s==="fromDate"||s==="toDate"?"DATE":typeof l=="boolean"?"BOOLEAN":typeof l=="number"?"NUMBER":"STRING";function Me({table:s,onFilterSubmit:l}){const[c,F]=h.useState(!1),[R,M]=h.useState(!1),[S,C]=h.useState(!1),i=we({resolver:De(Fe),defaultValues:{period:"",fromDate:"",toDate:"",status:"",senderId:void 0,msisdn:""}}),g=i.watch("period");h.useEffect(()=>{if(M(g==="CUSTOM"),g!=="CUSTOM"){const t=new Date;let r=new Date,n=new Date;switch(g){case"TODAY":r.setHours(0,0,0,0),n.setHours(23,59,59,999);break;case"YESTERDAY":r=new Date(t),r.setDate(t.getDate()-1),r.setHours(0,0,0,0),n=new Date(t),n.setDate(t.getDate()-1),n.setHours(23,59,59,999);break;case"THIS_WEEK":r=new Date(t);const o=t.getDate()-t.getDay();r.setDate(o),r.setHours(0,0,0,0),n=new Date(t),n.setHours(23,59,59,999);break;case"THIS_MONTH":r=new Date(t.getFullYear(),t.getMonth(),1),r.setHours(0,0,0,0),n=new Date(t),n.setHours(23,59,59,999);break;default:r=new Date(0),n=new Date(0);break}g?(i.setValue("fromDate",p(r)),i.setValue("toDate",p(n))):(i.setValue("fromDate",""),i.setValue("toDate",""))}},[g,i]);const{data:y,isLoading:E}=Ne({queryKey:["sender-ids"],queryFn:async()=>{var r;const t=await Ce.getCustomerSenderIds({page:0,size:1e4});return((r=t==null?void 0:t.content)==null?void 0:r.map(n=>({value:n.id,label:n.senderId})))||[]}}),V=async t=>{try{C(!0);const r=Object.entries(t).filter(([o,x])=>o==="period"||(o==="fromDate"||o==="toDate")&&!t.fromDate&&!t.toDate?!1:o!=="fromDate"&&o!=="toDate"?x!==void 0&&x!=="":!1).map(([o,x])=>o==="msisdn"?{key:"recipient",operator:"LIKE",field_type:"STRING",value:x,values:[x]}:o==="senderId"?{key:"sender.id",operator:"EQUAL",field_type:"STRING",value:x,values:[x]}:{key:o,operator:"EQUAL",field_type:Re(o,x),value:x,values:[x]});(t.fromDate||t.toDate)&&r.push({key:"createdAt",operator:"BETWEEN",field_type:"DATE",value:p(t.fromDate)||null,value_to:p(t.toDate)||null,values:[p(t.fromDate)||"",p(t.toDate)||""]});const n={filters:r,sorts:[],page:0,size:10};console.log("Submitting filter data:",n),l&&await l(n)}catch(r){console.error("Error applying filters:",r)}finally{C(!1)}},k=()=>{i.reset(),s.getAllColumns().forEach(t=>{t.setFilterValue(void 0)}),l&&l({filters:[],sorts:[],page:0,size:10})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex flex-1 flex-col-reverse sm:flex-row sm:items-center sm:space-x-2",children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs(m,{variant:"default",onClick:()=>F(!c),className:"h-8 px-3",children:["Filter ",e.jsx(Ie,{className:"ml-2 h-4 w-4"})]}),e.jsxs(m,{variant:"default",className:"h-8 px-3",children:["Export ",e.jsx(xe,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(Te,{table:s})]}),c&&e.jsx("div",{className:"mt-4 rounded-lg bg-white p-6 shadow-md",children:e.jsx(Se,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(V),className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsx(j,{control:i.control,name:"period",render:({field:t})=>e.jsxs(f,{children:[e.jsx(w,{children:"Period"}),e.jsxs(v,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(D,{children:e.jsx(I,{children:e.jsx(b,{placeholder:"Select one"})})}),e.jsxs(T,{children:[e.jsx(d,{value:"TODAY",children:"Today"}),e.jsx(d,{value:"YESTERDAY",children:"Yesterday"}),e.jsx(d,{value:"THIS_WEEK",children:"This week"}),e.jsx(d,{value:"THIS_MONTH",children:"This month"}),e.jsx(d,{value:"CUSTOM",children:"Custom"})]})]})]})}),R&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:i.control,name:"fromDate",render:({field:t})=>e.jsxs(f,{children:[e.jsx(w,{children:"From Date"}),e.jsx(D,{children:e.jsx(P,{type:"datetime-local",...t})})]})}),e.jsx(j,{control:i.control,name:"toDate",render:({field:t})=>e.jsxs(f,{children:[e.jsx(w,{children:"To Date"}),e.jsx(D,{children:e.jsx(P,{type:"datetime-local",...t})})]})})]}),e.jsx(j,{control:i.control,name:"senderId",render:({field:t})=>{var r;return e.jsxs(f,{children:[e.jsx(w,{children:"Sender ID"}),e.jsxs(v,{onValueChange:n=>t.onChange(Number(n)),defaultValue:(r=t.value)==null?void 0:r.toString(),children:[e.jsx(D,{children:e.jsx(I,{children:e.jsx(b,{placeholder:"Select sender ID"})})}),e.jsx(T,{children:E?e.jsx(d,{value:"loading",children:"Loading..."}):y==null?void 0:y.map(n=>e.jsx(d,{value:n.value.toString(),children:n.label},n.value))})]}),e.jsx(ye,{})]})}}),e.jsx(j,{control:i.control,name:"msisdn",render:({field:t})=>e.jsxs(f,{children:[e.jsx(w,{children:"Phone Number"}),e.jsx(D,{children:e.jsx(P,{...t,placeholder:"2557XXXXXXX"})})]})}),e.jsx(j,{control:i.control,name:"status",render:({field:t})=>e.jsxs(f,{children:[e.jsx(w,{children:"Status"}),e.jsxs(v,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(D,{children:e.jsx(I,{children:e.jsx(b,{placeholder:"Select one"})})}),e.jsxs(T,{children:[e.jsx(d,{value:"DELIVERED",children:"Delivered"}),e.jsx(d,{value:"PENDING",children:"Pending"}),e.jsx(d,{value:"SENT",children:"Sent"}),e.jsx(d,{value:"FAILED",children:"Failed"})]})]})]})}),e.jsxs("div",{className:"col-span-full flex justify-end mt-4",children:[e.jsx(m,{type:"submit",variant:"default",disabled:S,children:S?"Applying...":"Apply Filters"}),e.jsx(m,{type:"button",variant:"outline",className:"ml-2",onClick:k,disabled:S,children:"Clear Filters"})]})]})})})]})}function Xe({columns:s,data:l,pagination:c,onPaginationChange:F,totalElements:R,onFilterSubmit:M}){var r;const[S,C]=h.useState({}),[i,g]=h.useState({}),[y,E]=h.useState([]),[V,k]=h.useState([]),t=Q({data:l,columns:s,state:{sorting:V,columnVisibility:i,rowSelection:S,columnFilters:y,pagination:c},manualPagination:!0,pageCount:Math.ceil(R/c.pageSize),onPaginationChange:n=>{const o=typeof n=="function"?n(c):n;F(o)},enableRowSelection:!0,onRowSelectionChange:C,onSortingChange:k,onColumnFiltersChange:E,onColumnVisibilityChange:g,getCoreRowModel:$(),getFilteredRowModel:J(),getPaginationRowModel:Z(),getSortedRowModel:ee(),getFacetedRowModel:se(),getFacetedUniqueValues:te()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Me,{table:t,onFilterSubmit:M}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ae,{children:[e.jsx(ne,{children:t.getHeaderGroups().map(n=>e.jsx(A,{children:n.headers.map(o=>e.jsx(le,{colSpan:o.colSpan,children:o.isPlaceholder?null:U(o.column.columnDef.header,o.getContext())},o.id))},n.id))}),e.jsx(re,{children:(r=t.getRowModel().rows)!=null&&r.length?t.getRowModel().rows.map(n=>e.jsx(A,{"data-state":n.getIsSelected()&&"selected",children:n.getVisibleCells().map(o=>e.jsx(Y,{children:U(o.column.columnDef.cell,o.getContext())},o.id))},n.id)):e.jsx(A,{children:e.jsx(Y,{colSpan:s.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(be,{table:t})]})}function u({column:s,title:l,className:c}){return s.getCanSort()?e.jsx("div",{className:z("flex items-center space-x-2",c),children:e.jsxs(H,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:l}),s.getIsSorted()==="desc"?e.jsx(K,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(B,{className:"ml-2 h-4 w-4"}):e.jsx(he,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(L,{align:"start",children:[e.jsxs(N,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(B,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(N,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(K,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),e.jsx(O,{}),e.jsxs(N,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(ge,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})}):e.jsx("div",{className:z(c),children:l})}const Ee=a.object({id:a.number(),campaign:a.any().optional(),senderId:a.any().optional(),recipient:a.any().optional(),message:a.any().optional(),status:a.any().optional(),statusSmsc:a.any().optional(),dlr:a.any().optional(),network:a.any().optional(),smscUsername:a.any().optional(),smscPassword:a.any().optional(),sendingNetwork:a.any().optional(),smsCount:a.any().optional(),dateSent:a.any().optional(),customer:a.any().optional(),plan:a.any().optional(),messageId:a.any().optional(),smsType:a.any().optional(),template:a.any().optional(),deliveryDate:a.any().optional(),initiatedBy:a.any().optional(),createdAt:a.any().optional(),updatedAt:a.any().optional()});function Ve({row:s}){const l=Ee.parse(s.original),c=X();return e.jsxs(H,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(L,{align:"end",className:"w-[160px]",children:[e.jsx(N,{onClick:()=>{c("/message-detail",{state:{sms:l}})},children:"View"}),e.jsx(O,{}),e.jsx(N,{children:"Delete"})]})]})}const We=[{id:"select",header:({table:s})=>e.jsx(_,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:l=>s.toggleAllPageRowsSelected(!!l),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(_,{checked:s.getIsSelected(),onCheckedChange:l=>s.toggleSelected(!!l),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsx(u,{column:s,title:"#"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"sender",header:({column:s})=>e.jsx(u,{column:s,title:"Sender"}),cell:({row:s})=>e.jsx("span",{children:String(s.getValue("sender").senderId)})},{accessorKey:"recipient",header:({column:s})=>e.jsx(u,{column:s,title:"Recipient"})},{accessorKey:"message",header:({column:s})=>e.jsx(u,{column:s,title:"Message"}),cell:({row:s})=>e.jsxs("div",{className:"max-w-[150px] truncate",children:[String(s.getValue("message")).substring(0,50)," ..."]})},{accessorKey:"status",header:({column:s})=>e.jsx(u,{column:s,title:"Status"}),cell:({row:s})=>e.jsx(ve,{variant:s.getValue("status")==="FAILED"?"destructive":s.getValue("status")==="DELIVERED"?"success":"secondary",children:s.getValue("status")})},{accessorKey:"network",header:({column:s})=>e.jsx(u,{column:s,title:"Network"})},{accessorKey:"createdAt",header:({column:s})=>e.jsx(u,{column:s,title:"Timestamp"}),cell:({row:s})=>W(s.original.createdAt).format("YYYY-MM-DD HH:mm:ss")},{id:"actions",cell:({row:s})=>e.jsx(Ve,{row:s})}];export{Xe as D,We as c};
