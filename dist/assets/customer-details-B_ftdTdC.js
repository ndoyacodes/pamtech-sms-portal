import{u as e,j as s,B as t,y as a,r as i,m as n,l as r}from"./index-DgsANLC3.js";import{C as l,a as c,c as d,d as o}from"./card-Cxkzk52A.js";import{L as m}from"./use-auth-store-DlB6JPqf.js";import{u as x,T as u,U as h,S as j}from"./user-nav-BjY9odv6.js";import{c as p}from"./customer-hook-DtrhpQio.js";import{C as v}from"./cusstomer-approval-modal-3CVgqs6J.js";import{D as f,a as g,b as N,c as y}from"./dialog-Cxh4_yU0.js";import{F as b,a as S,b as w,c as I,e as C}from"./form-CU8rwvsz.js";import{I as k}from"./input-BaSBk-Gd.js";import{t as D}from"./zod-8yhIYjTx.js";import{u as M}from"./index.esm-3KLEzfMo.js";import{z as P}from"./index-B0zZW6rS.js";import{u as E}from"./useMutation-Bxa_RUaj.js";import{B as F}from"./badge-DkFHinrL.js";import{A as T}from"./instance-SAW19xTi.js";import{M as A,B as L,S as O}from"./shield-B16-7wBW.js";import{G as Y}from"./globe-Cdvf1KkP.js";import{L as B}from"./languages-BRjEhm_4.js";import{c as U}from"./createLucideIcon-DHucisN1.js";import{C as V}from"./calendar-C0l8uDaX.js";import{f as q}from"./format-2Kviky6Q.js";import"./index-8bOQzAwE.js";import"./index-D_xSc7Or.js";import"./index-ccUYw2Nl.js";import"./Combination-BCJfLLTG.js";import"./index-ByCmscx5.js";import"./index-BuCM2Ckj.js";import"./index-BQ1RgSiI.js";import"./label-BTdkY-TR.js";import"./textarea-B6_lc-Cl.js";
/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=U("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),H=U("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),R=U("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Z=U("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),z=({isOpen:t,onClose:a,title:i="Document Viewer"})=>{const{id:n}=e(),{data:r,isLoading:l,error:c}=x({queryKey:["customer-kycfile",n],queryFn:async()=>{try{const e=await p.getCustomerKycFile(n),s=atob(e),t=[];for(let i=0;i<s.length;i+=512){const e=s.slice(i,i+512),a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e.charCodeAt(s);const n=new Uint8Array(a);t.push(n)}const a=new Blob(t,{type:"application/pdf"});return URL.createObjectURL(a)}catch(e){throw e}}});return s.jsx(f,{open:t,onOpenChange:a,children:s.jsxs(g,{className:"max-w-4xl h-[80vh]",children:[s.jsx(N,{children:s.jsx(y,{children:i})}),l?s.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading document..."}):c?s.jsx("div",{className:"flex items-center justify-center h-full text-red-500",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-medium",children:"Error loading document"}),s.jsx("div",{className:"text-sm mt-1",children:c instanceof Error?c.message:"Please try again"})]})}):s.jsx("div",{className:"flex-1 w-full h-full min-h-[60vh]",children:r?s.jsx("iframe",{src:r,width:"100%",height:"100%",className:"rounded-md",title:"PDF Viewer"}):s.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No document available"})})]})})},K=$;
/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function $(e,s){const t=W();return($=function(e,s){return t[e-=448]})(e,s)}function W(){const e=["1040811riNEVw","search","ZwIuF","3563145OuKWWg","255951YlyFkv","oHUik","620774udDTtM","previewInvoice","580DdEsxf","toString","post","9621535EixtaM","generateInvoice","2173880bGYbXO","37685vPCfNY","/invoice/generate","894Bdddfq","4IMaVhT","/invoice/preview","264wyRMVm","constructor","(((.+)+)+)+$"];return(W=function(){return e})()}!function(){const e=$,s=W();for(;;)try{if(774105===-parseInt(e(458))/1+-parseInt(e(449))/2+-parseInt(e(461))/3*(-parseInt(e(453))/4)+-parseInt(e(450))/5*(parseInt(e(452))/6)+-parseInt(e(469))/7+-parseInt(e(455))/8*(-parseInt(e(462))/9)+-parseInt(e(466))/10*(-parseInt(e(464))/11))break;s.push(s.shift())}catch(t){s.push(s.shift())}}();const J=function(){let e=!0;return function(s,t){const a=e?function(){if(t){const e=t.apply(s,arguments);return t=null,e}}:function(){};return e=!1,a}}()(void 0,(function(){const e=$,s={ZwIuF:e(457)};return J[e(467)]()[e(459)](s[e(460)])[e(467)]()[e(456)](J)[e(459)](s.ZwIuF)}));J();class Q extends T{constructor(){super({oHUik:"baseService"}[$(463)])}[K(465)](e){const s=K,t={xYkUx:s(454)};return this[s(468)](t.xYkUx,e)}[K(448)](e){const s=K;return this.post(s(451),e)}}const X=new Q;function _({isOpen:e,onClose:i,invoiceData:n,period:r,onSendSuccess:l}){var c,d;const{mutate:o,isPending:m}=E({mutationFn:()=>X.generateInvoice({invoiceId:n.invoiceId,customerId:n.customerId,period:r}),onSuccess:()=>{a.success("Invoice sent successfully"),i(),null==l||l()},onError:e=>{var s,t;const i=(null==(t=null==(s=null==e?void 0:e.response)?void 0:s.data)?void 0:t.message)||"Failed to send invoice";a.error(i)}});return s.jsx(f,{open:e,onOpenChange:i,children:s.jsxs(g,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(N,{children:s.jsx(y,{children:"Invoice Preview"})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:n.customerName}),s.jsx("p",{className:"text-sm text-muted-foreground",children:n.customerEmail})]}),s.jsxs("div",{className:"flex flex-col items-end gap-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(e=>{const t={SENT:"bg-blue-500",PAID:"bg-green-500",PENDING:"bg-yellow-500",CANCELLED:"bg-red-500",DEFAULT:"bg-gray-500"};return s.jsx(F,{className:t[e]||t.DEFAULT,children:e})})(n.invoiceStatus)]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:n.invoiceDate}),n.invoiceNumber&&s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Invoice #: ",n.invoiceNumber]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Total SMS"}),s.jsx("p",{className:"text-xl font-semibold",children:n.smsCount})]}),s.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Amount"}),s.jsx("p",{className:"text-xl font-semibold",children:null==(c=null==n?void 0:n.total)?void 0:c.toLocaleString(void 0,{style:"currency",currency:"TZS",minimumFractionDigits:2})})]}),s.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Customer ID"}),s.jsx("p",{className:"text-xl font-semibold",children:n.customerId})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"SMS Breakdown"}),s.jsx("div",{className:"border rounded-lg overflow-hidden",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-muted/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 text-left text-xs font-medium",children:"Sender"}),s.jsx("th",{className:"p-3 text-left text-xs font-medium",children:"Network"}),s.jsx("th",{className:"p-3 text-right text-xs font-medium",children:"SMS Sent"}),s.jsx("th",{className:"p-3 text-right text-xs font-medium",children:"Price/SMS"}),s.jsx("th",{className:"p-3 text-right text-xs font-medium",children:"Amount"})]})}),s.jsx("tbody",{className:"divide-y",children:null==(d=null==n?void 0:n.smsSummaryData)?void 0:d.map(((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"p-3 text-sm",children:e.sender}),s.jsx("td",{className:"p-3 text-sm",children:e.network}),s.jsx("td",{className:"p-3 text-sm text-right",children:e.smsSent.toLocaleString()}),s.jsx("td",{className:"p-3 text-sm text-right",children:e.price.toLocaleString(void 0,{style:"currency",currency:"TZS",minimumFractionDigits:2})}),s.jsx("td",{className:"p-3 text-sm text-right",children:e.amount.toLocaleString(void 0,{style:"currency",currency:"TZS"})})]},t)))})]})})]})]}),s.jsxs("div",{className:"flex justify-end pt-4 gap-2",children:[s.jsx(t,{variant:"outline",onClick:i,children:"Close"}),s.jsx(t,{onClick:()=>{n.invoiceId?r?o():a.error("Period is missing"):a.error("Invoice ID is missing")},loading:m,disabled:m||"SENT"===n.invoiceStatus,children:"SENT"===n.invoiceStatus?"Already Sent":"Send Invoice"})]})]})})}const ee=P.object({period:P.string().min(1,"Month is required").regex(/^\d{4}-\d{2}$/,"Must be in YYYY-MM format").refine((e=>{const[s,t]=e.split("-").map(Number),a=new Date(s,t-1),i=new Date;return a<=new Date(i.getFullYear(),i.getMonth()-1)}),"Cannot select current or future months"),customerId:P.number()});function se({isOpen:e,onClose:r,title:l="Generate Invoice",customer:c}){const[d,o]=i.useState(null),[m,x]=i.useState(""),u=n(),h=M({resolver:D(ee),defaultValues:{period:"",customerId:c.id}}),{mutate:j,isPending:p}=E({mutationFn:e=>X.previewInvoice(e),onSuccess:e=>{u.invalidateQueries({queryKey:["invoice","customer-details"]}),o({...e,period:m})},onError:e=>{var s,t;const i=(null==(t=null==(s=null==e?void 0:e.response)?void 0:s.data)?void 0:t.message)||"Failed to generate invoice";a.error(i)}}),v=new Date,P=new Date(v.getFullYear(),v.getMonth()-1),F=`${P.getFullYear()}-${String(P.getMonth()+1).padStart(2,"0")}`;return s.jsxs(s.Fragment,{children:[s.jsx(f,{open:e,onOpenChange:r,children:s.jsxs(g,{className:"max-w-xs",children:[s.jsx(N,{children:s.jsx(y,{children:l})}),s.jsx(b,{...h,children:s.jsxs("form",{onSubmit:h.handleSubmit((e=>{x(e.period),j(e)})),className:"space-y-4",children:[s.jsx(S,{control:h.control,name:"period",render:({field:e})=>s.jsxs(w,{children:[s.jsx(I,{children:"Period *"}),s.jsx(k,{type:"month",...e,placeholder:"Select month",max:F,required:!0}),s.jsx(C,{})]})}),s.jsx("div",{className:"flex justify-end",children:s.jsx(t,{type:"submit",className:"w-full md:w-auto",loading:p,children:"Generate Invoice"})})]})})]})}),d&&s.jsx(_,{isOpen:!!d,onClose:()=>{o(null),r()},invoiceData:d,period:m})]})}const te=()=>{var a;const{id:n}=e(),[f,g]=i.useState(!1),[N,y]=i.useState(!1),[b,S]=i.useState(!1),[w,I]=i.useState(!1),C=r(),{data:k,isLoading:D}=x({queryKey:["customer-details",n],queryFn:()=>p.getCustomerById(n)});return D?s.jsxs(m,{children:[s.jsx(m.Header,{sticky:!0,className:"mt-4 sm:mt-4 md:mt-0 lg:mt-0",children:s.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[s.jsx(u,{}),s.jsx(h,{})]})}),s.jsx(m.Body,{children:s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white"})})})]}):s.jsxs(m,{children:[s.jsxs(m.Header,{sticky:!0,className:"mt-4 sm:mt-4 md:mt-0 lg:mt-0",children:[s.jsx(j,{}),s.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[s.jsx(u,{}),s.jsx(h,{})]})]}),s.jsxs(m.Body,{children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between space-y-2",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Customer Details"}),s.jsx("p",{className:"text-muted-foreground",children:"View and manage customer information"})]}),s.jsxs("div",{className:"flex gap-2",children:["PENDING"!==(null==k?void 0:k.approvalStatus)&&"POSTPAID"===(null==k?void 0:k.customerType)&&s.jsx(s.Fragment,{children:s.jsx(t,{variant:"default",onClick:()=>I(!0),children:"Generate Invoice"})}),s.jsx(t,{variant:"outline",onClick:()=>{C("/customers/add",{state:{record:k}})},children:"Edit Customer"}),"PENDING"===(null==k?void 0:k.approvalStatus)&&s.jsxs(s.Fragment,{children:[s.jsx(t,{variant:"default",onClick:()=>g(!0),children:"Approve"}),s.jsx(t,{onClick:()=>y(!0),variant:"destructive",children:"Reject"})]}),"PENDING"===(null==k?void 0:k.approvalStatus)&&s.jsx(s.Fragment,{children:s.jsx(t,{variant:"destructive",onClick:()=>y(!0),children:"Revoke"})})]})]}),s.jsxs(l,{children:[s.jsx(c,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h3",{className:"text-xl font-semibold",children:[null==k?void 0:k.firstName," ",null==k?void 0:k.lastName]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"rounded-full px-2 py-1 text-sm "+((null==k?void 0:k.status)?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:(null==k?void 0:k.status)?"Active":"Inactive"}),s.jsx("span",{className:"rounded-full px-2 py-1 text-sm "+("APPROVED"===(null==k?void 0:k.approvalStatus)?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:null==k?void 0:k.approvalStatus})]})]})}),s.jsxs(d,{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"mb-4 font-semibold",children:"Personal Information"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(A,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),s.jsx("p",{className:"font-medium",children:null==k?void 0:k.email})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(L,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Company Name"}),s.jsx("p",{className:"font-medium",children:null==k?void 0:k.companyName})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(Y,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Website"}),s.jsx("p",{className:"font-medium",children:null==k?void 0:k.website})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(B,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Language"}),s.jsx("p",{className:"font-medium",children:null==(a=null==k?void 0:k.language)?void 0:a.toUpperCase()})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(H,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Timezone"}),s.jsx("p",{className:"font-medium",children:null==k?void 0:k.timezone})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"mb-4 font-semibold",children:"Account Information"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(O,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Customer Type"}),s.jsx("p",{className:"font-medium",children:(null==k?void 0:k.customerType)||"Not specified"})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(Z,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"SMS Balance"}),s.jsx("p",{className:"font-medium",children:null==k?void 0:k.smsBalance})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(G,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Pending SMS"}),s.jsx("p",{className:"font-medium",children:(null==k?void 0:k.hasPendingSMS)?"Yes":"No"})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(V,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Created At"}),s.jsx("p",{className:"font-medium",children:q(new Date(null==k?void 0:k.createdAt),"PPpp")})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(V,{className:"h-5 w-5 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Last Updated"}),s.jsx("p",{className:"font-medium",children:q(new Date(null==k?void 0:k.updatedAt),"PPpp")})]})]})]})]}),s.jsxs(o,{className:"border-t p-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(R,{className:"h-5 w-5 text-gray-500"}),s.jsx("p",{className:"text-sm text-gray-500",children:"KYC Document:"}),s.jsx("div",{onClick:()=>S(!0),rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Open"})]}),(null==k?void 0:k.remarks)&&s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Remarks:"}),s.jsx("p",{className:"mt-1",children:null==k?void 0:k.remarks})]})]})]})]}),f&&s.jsx(v,{customerId:null==k?void 0:k.id,onClose:()=>g(!1),actionType:"APPROVE"}),f&&s.jsx(v,{customerId:null==k?void 0:k.id,actionType:"APPROVE",onClose:()=>{g(!1)}}),N&&s.jsx(v,{customerId:null==k?void 0:k.id,actionType:"REJECT",onClose:()=>{y(!1)}}),b&&s.jsx(z,{isOpen:b,onClose:()=>S(!1),title:null==k?void 0:k.firstName}),w&&s.jsx(se,{isOpen:w,onClose:()=>I(!1),title:`Generate invoice for ${null==k?void 0:k.firstName}`,customer:k})]})};export{te as default};
